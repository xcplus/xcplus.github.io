<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>微信小程序定制Navigation</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/6b7407e5a7346cc0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6b7407e5a7346cc0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-266da34e2468c883.js" defer=""></script><script src="/_next/static/chunks/framework-281bd828f4ecdac7.js" defer=""></script><script src="/_next/static/chunks/main-5712a0d871ba0756.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5aa6660ad80e5004.js" defer=""></script><script src="/_next/static/chunks/720-cfd8b9301b1b5f7f.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-e8b991116ca82f6d.js" defer=""></script><script src="/_next/static/4plFcxwAT7sB-HsrHNZDb/_buildManifest.js" defer=""></script><script src="/_next/static/4plFcxwAT7sB-HsrHNZDb/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex justify-center"><div class="fixed top-4 bg-white z-20 rounded-full dark:bg-slate-800"><nav class="px-2 py-2 flex rounded-full items-center font-semibold bg-transparent shadow-lg dark:shadow-md dark:shadow-slate-800"><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/">首页</a><a class="nav_link bg-indigo-700 rounded-full text-white" href="/articles">文章</a><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/projects">项目</a><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/about">关于</a></nav></div></div><div class="app antialiased pt-28"><div class="mx-6 sm:mx-16 flex-1 max-w-full"><div class="px-1"><div class="flex flex-col justify-center items-center gap-4 px-2"><div class=" font-extrabold text-2xl">微信小程序定制Navigation</div><div class="flex gap-4"><div class=" font-medium text-slate-400 ">2023-12-04</div><div class="flex gap-2"><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->taro</span><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->微信小程序</span><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->定制Navigation</span><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->mobx</span></div></div></div><div class="mt-4 tracking-wide leading-8 overflow-y-scroll mx-0 px-2 max-w-full prose lg:prose-xl dark:prose-invert"><blockquote>
<p>最近在开发小程序，因为会一点react，所以选择taro作为开发工具。根据UI给的设计图看到有定制的Navigation，查了一些资料，顺手记录下来，后续容易找到快速恢复记忆。</p>
</blockquote>
<h3>安装mobx和mobx-react-lite</h3>
<p>这里我使用了mobx作为状态管理，安装了以下库：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-shell" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#f08d49">pnpm</span><span> </span><span class="token token" style="color:#f08d49">install</span><span> mobx
</span><span></span><span class="token token" style="color:#f08d49">pnpm</span><span> </span><span class="token token" style="color:#f08d49">install</span><span> mobx-react-lite</span></code></div></pre>
<p>通过mobx获取和管理Navigation的高度、内容区的高度、底部tabbar的高度等。</p>
<h3>创建获取数据的类Screen</h3>
<p>首先我创建了一个类Screen：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">Taro</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;@tarojs/taro&#x27;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> makeAutoObservable </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&quot;mobx&quot;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">class</span><span> </span><span class="token token" style="color:#f8c555">Screen</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#999">// menuButton 高度</span><span>
</span><span>  menuButtonHeight </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">0</span><span>
</span><span>  </span><span class="token token" style="color:#999">// menuButton 到顶部的高度</span><span>
</span><span>  menuButtonTop </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">0</span><span>
</span><span>  </span><span class="token token" style="color:#999">// menuButton左边的宽度(去掉了右边间距)</span><span>
</span><span>  menuButtonLeftWidth </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">0</span><span>
</span><span>  </span><span class="token token" style="color:#999">// 顶部navigation的高度</span><span>
</span><span>  navigationHeight </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">0</span><span>
</span><span>  </span><span class="token token" style="color:#999">// menuButton右边间距</span><span>
</span><span>  menuButtonRightWidth </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">0</span><span>
</span><span>  </span><span class="token token" style="color:#999">// 去掉底部tabbar和顶部navigation bar的高度</span><span>
</span><span>  contentHeightWithTabbar </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">0</span><span>
</span><span>  </span><span class="token token" style="color:#999">// 去掉顶部navigation bar的高度</span><span>
</span><span>  contentHeightWithOutTabbar </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">0</span><span>
</span>
<span>  </span><span class="token token" style="color:#999">// rpx和px转换时使用</span><span>
</span><span>  pixelRatio </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">0</span><span>
</span>
<span>  </span><span class="token token" style="color:#f08d49">constructor</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">const</span><span> menuButtonInfo </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token maybe-class-name">Taro</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">getMenuButtonBoundingClientRect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">const</span><span> systemInfo </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token maybe-class-name">Taro</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">getSystemInfoSync</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token" style="color:#999">// menuButton 高度</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">menuButtonHeight</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> menuButtonInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">height</span><span>
</span><span>    </span><span class="token token" style="color:#999">// menuButton 到顶部的高度</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">menuButtonTop</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> menuButtonInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">top</span><span>
</span><span>    </span><span class="token token" style="color:#999">// Navigation的高度 = (menuButton的顶部位置 - 状态栏高度) * 2 + menuButton的高度 + 状态栏高度</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">navigationHeight</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span>menuButtonInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">top</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">statusBarHeight</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">*</span><span> </span><span class="token token" style="color:#f08d49">2</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> menuButtonInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">height</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">statusBarHeight</span><span>
</span><span>    </span><span class="token token" style="color:#999">// menuButton右边宽度 = 屏幕宽度 - menuButton右边的位置</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">menuButtonRightWidth</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">screenWidth</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> menuButtonInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">right</span><span>
</span><span>    </span><span class="token token" style="color:#999">// menuButton左边宽度 = menuButton左边的位置 - menuButton右边宽度</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">menuButtonLeftWidth</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> menuButtonInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">left</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">menuButtonRightWidth</span><span>
</span><span>    </span><span class="token token" style="color:#999">// 含有tabbar的内容区域高度 = 屏幕高度 - navigation高度 - 60(tabbar固定50px，我这里多减出10) - (屏幕高度 - 安全区域底部位置)</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">contentHeightWithTabbar</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">screenHeight</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">navigationHeight</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> </span><span class="token token" style="color:#f08d49">60</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> </span><span class="token token" style="color:#ccc">(</span><span>systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">screenHeight</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">safeArea</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">bottom</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#999">// 不含有tabbar的内容区域高度 = 屏幕高度 - navigation高度 - (屏幕高度 - 安全区域底部位置)</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">contentHeightWithOutTabbar</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">screenHeight</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">navigationHeight</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> </span><span class="token token" style="color:#ccc">(</span><span>systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">screenHeight</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">safeArea</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">bottom</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#999">// 这里计算出rpx和px的转换率</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">pixelRatio</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">750</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span> systemInfo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">windowWidth</span><span>
</span><span>    </span><span class="token token" style="color:#f08d49">makeAutoObservable</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">{</span><span class="token token literal-property" style="color:#f8c555">autoBind</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#f08d49">true</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>你也可以根据一下两个</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">const</span><span> menuButtonInfo </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token maybe-class-name">Taro</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">getMenuButtonBoundingClientRect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> systemInfo </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token maybe-class-name">Taro</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">getSystemInfoSync</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>信息获取更多你需要的值，然后应用到你的页面的中。</p>
<h3>将Screen应用到app中</h3>
<p>开始使用screen这个类把获取的数据应用到对应的页面。
直接上代码：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> createContext</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useContext </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&quot;react&quot;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">Screen</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&quot;./screen&quot;</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 创建一个类来管理所有的值</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">class</span><span> </span><span class="token token" style="color:#f8c555">RootStore</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#f08d49">constructor</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">this</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">screen</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span>  </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Screen</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 初始化RootStore</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> rootStore </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">RootStore</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 创建上下文对象</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token maybe-class-name">RootStoreContext</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">createContext</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#999">// 根据上下文对象封装一个组件</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#f08d49">RootStoreProvider</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token parameter" style="color:#ccc">{</span><span class="token token parameter">children</span><span class="token token parameter" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">RootStoreContext</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access maybe-class-name">Provider</span><span> value</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>rootStore</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#ccc">{</span><span>children</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">RootStoreContext</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access maybe-class-name">Provider</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 默认导出 provider</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">RootStoreProvider</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 封装一个获取上下文对象的方法</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">useRootStore</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#f08d49">useContext</span><span class="token token" style="color:#ccc">(</span><span class="token token maybe-class-name">RootStoreContext</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>在入口文件中使用：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useLaunch </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;@tarojs/taro&#x27;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token" style="color:#7ec699">&#x27;./app.scss&#x27;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">RootStoreProvider</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;./store&#x27;</span><span>
</span>
<!-- -->
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">App</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter" style="color:#ccc">{</span><span class="token token parameter"> children </span><span class="token token parameter" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span>
<span>  </span><span class="token token" style="color:#f08d49">useLaunch</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token console" style="color:#f8c555">console</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">log</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;App launched.&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>  </span><span class="token token" style="color:#999">// children 是将要会渲染的页面</span><span>
</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">RootStoreProvider</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">{</span><span>children</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">RootStoreProvider</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">App</span></code></div></pre>
<p>我们可以提出一个定制的navigation组件来,在用到的地方引入使用即可：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">Taro</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;@tarojs/taro&#x27;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> </span><span class="token token imports maybe-class-name">View</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports maybe-class-name">Image</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;@tarojs/components&#x27;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> observer </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;mobx-react-lite&#x27;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useRootStore </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;../store&#x27;</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports">returnBack</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&quot;../resource/return_back.png&quot;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token maybe-class-name">Navigation</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">observer</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter" style="color:#ccc">{</span><span class="token token parameter">title</span><span class="token token parameter" style="color:#ccc">,</span><span class="token token parameter"> showback</span><span class="token token parameter" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">{</span><span> screen </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useRootStore</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">goBackBtn</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token maybe-class-name">Taro</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">navigateBack</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">View</span><span>
</span><span>        className</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&#x27;custom-navigation&#x27;</span><span>
</span><span>        style</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#ccc">{</span><span>
</span><span>          </span><span class="token token literal-property" style="color:#f8c555">left</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">${</span><span class="token token template-string interpolation">screen</span><span class="token token template-string interpolation" style="color:#ccc">.</span><span class="token token template-string interpolation property-access">menuButtonRightWidth</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">}</span><span class="token token template-string" style="color:#7ec699">px</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>          </span><span class="token token literal-property" style="color:#f8c555">top</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">${</span><span class="token token template-string interpolation">screen</span><span class="token token template-string interpolation" style="color:#ccc">.</span><span class="token token template-string interpolation property-access">menuButtonTop</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">}</span><span class="token token template-string" style="color:#7ec699">px</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>          </span><span class="token token literal-property" style="color:#f8c555">height</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">${</span><span class="token token template-string interpolation">screen</span><span class="token token template-string interpolation" style="color:#ccc">.</span><span class="token token template-string interpolation property-access">menuButtonHeight</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">}</span><span class="token token template-string" style="color:#7ec699">px</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>          </span><span class="token token literal-property" style="color:#f8c555">width</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">${</span><span class="token token template-string interpolation">screen</span><span class="token token template-string interpolation" style="color:#ccc">.</span><span class="token token template-string interpolation property-access">navigationWidth</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">}</span><span class="token token template-string" style="color:#7ec699">px</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>          showback </span><span class="token token" style="color:#67cdcc">?</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">View</span><span> className</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;back-btn&quot;</span><span> onClick</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#f08d49">goBackBtn</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">Image</span><span> src</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>returnBack</span><span class="token token" style="color:#ccc">}</span><span> className</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;icon-36-50&quot;</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">View</span><span class="token token" style="color:#67cdcc">&gt;</span><span> </span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token null nil" style="color:#cc99cd">null</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">}</span><span>
</span><span>        </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">View</span><span> className</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&#x27;fixed font36 bold white center width100&#x27;</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">{</span><span>title</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">View</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">View</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">View</span><span> style</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#ccc">{</span><span class="token token literal-property" style="color:#f8c555">height</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">${</span><span class="token token template-string interpolation">screen</span><span class="token token template-string interpolation" style="color:#ccc">.</span><span class="token token template-string interpolation property-access">navigationHeight</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">}</span><span class="token token template-string" style="color:#7ec699">px</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">View</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">Navigation</span></code></div></pre>
<p>以上就是主要代码和逻辑；大体流程就是，</p>
<ol>
<li>通过mobx管理，使用微信给的接口获取navigation需要相关信息</li>
<li>封装上下文</li>
<li>通过上下文把信息传递给需要使用信息的组件</li>
</ol></div></div></div><footer class="w-full border-t mt-8"><div class="border-t border-salte-100 pb-8 pt-4 dark:border-slate-900"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-indigo-500" href="/articles">文章</a><a class="transition hover:text-indigo-500" href="/projects">项目</a><a class="transition hover:text-indigo-500" href="/about">关于</a></div><p class="text-sm text-zinc-400 dark:text-zinc-500">© 2023 Xcplus. 保留所有权.</p></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"articleData":{"markdownContent":"\n\u003e 最近在开发小程序，因为会一点react，所以选择taro作为开发工具。根据UI给的设计图看到有定制的Navigation，查了一些资料，顺手记录下来，后续容易找到快速恢复记忆。\n\n### 安装mobx和mobx-react-lite\n这里我使用了mobx作为状态管理，安装了以下库：\n```shell\npnpm install mobx\npnpm install mobx-react-lite\n```\n通过mobx获取和管理Navigation的高度、内容区的高度、底部tabbar的高度等。\n\n### 创建获取数据的类Screen\n\n首先我创建了一个类Screen：\n```js\nimport Taro from '@tarojs/taro'\nimport { makeAutoObservable } from \"mobx\";\nclass Screen {\n  // menuButton 高度\n  menuButtonHeight = 0\n  // menuButton 到顶部的高度\n  menuButtonTop = 0\n  // menuButton左边的宽度(去掉了右边间距)\n  menuButtonLeftWidth = 0\n  // 顶部navigation的高度\n  navigationHeight = 0\n  // menuButton右边间距\n  menuButtonRightWidth = 0\n  // 去掉底部tabbar和顶部navigation bar的高度\n  contentHeightWithTabbar = 0\n  // 去掉顶部navigation bar的高度\n  contentHeightWithOutTabbar = 0\n\n  // rpx和px转换时使用\n  pixelRatio = 0\n\n  constructor() {\n    const menuButtonInfo = Taro.getMenuButtonBoundingClientRect();\n    const systemInfo = Taro.getSystemInfoSync();\n    // menuButton 高度\n    this.menuButtonHeight = menuButtonInfo.height\n    // menuButton 到顶部的高度\n    this.menuButtonTop = menuButtonInfo.top\n    // Navigation的高度 = (menuButton的顶部位置 - 状态栏高度) * 2 + menuButton的高度 + 状态栏高度\n    this.navigationHeight = (menuButtonInfo.top - systemInfo.statusBarHeight) * 2 + menuButtonInfo.height + systemInfo.statusBarHeight\n    // menuButton右边宽度 = 屏幕宽度 - menuButton右边的位置\n    this.menuButtonRightWidth = systemInfo.screenWidth - menuButtonInfo.right\n    // menuButton左边宽度 = menuButton左边的位置 - menuButton右边宽度\n    this.menuButtonLeftWidth = menuButtonInfo.left - this.menuButtonRightWidth\n    // 含有tabbar的内容区域高度 = 屏幕高度 - navigation高度 - 60(tabbar固定50px，我这里多减出10) - (屏幕高度 - 安全区域底部位置)\n    this.contentHeightWithTabbar = systemInfo.screenHeight - this.navigationHeight - 60 - (systemInfo.screenHeight - systemInfo.safeArea.bottom)\n    // 不含有tabbar的内容区域高度 = 屏幕高度 - navigation高度 - (屏幕高度 - 安全区域底部位置)\n    this.contentHeightWithOutTabbar = systemInfo.screenHeight - this.navigationHeight - (systemInfo.screenHeight - systemInfo.safeArea.bottom)\n    // 这里计算出rpx和px的转换率\n    this.pixelRatio = 750 / systemInfo.windowWidth\n    makeAutoObservable(this, {}, {autoBind: true})\n  }\n}\n```\n\n你也可以根据一下两个\n```js\nconst menuButtonInfo = Taro.getMenuButtonBoundingClientRect();\nconst systemInfo = Taro.getSystemInfoSync();\n```\n信息获取更多你需要的值，然后应用到你的页面的中。\n\n### 将Screen应用到app中\n\n开始使用screen这个类把获取的数据应用到对应的页面。\n直接上代码：\n```js\nimport { createContext, useContext } from \"react\"\nimport Screen from \"./screen\"\n\n// 创建一个类来管理所有的值\nclass RootStore {\n  constructor() {\n    this.screen =  new Screen()\n  }\n}\n\n// 初始化RootStore\nconst rootStore = new RootStore()\n\n// 创建上下文对象\nconst RootStoreContext = createContext()\n// 根据上下文对象封装一个组件\nconst RootStoreProvider = ({children}) =\u003e {\n  return (\n    \u003cRootStoreContext.Provider value={rootStore}\u003e\n      {children}\n    \u003c/RootStoreContext.Provider\u003e\n  )\n}\n\n// 默认导出 provider\nexport default RootStoreProvider\n\n// 封装一个获取上下文对象的方法\nexport const useRootStore = () =\u003e useContext(RootStoreContext)\n```\n\n在入口文件中使用：\n```js\nimport { useLaunch } from '@tarojs/taro'\nimport './app.scss'\nimport RootStoreProvider from './store'\n\n\nfunction App({ children }) {\n\n  useLaunch(() =\u003e {\n    console.log('App launched.')\n  })\n\n  // children 是将要会渲染的页面\n  return \u003cRootStoreProvider\u003e{children}\u003c/RootStoreProvider\u003e\n}\n\nexport default App\n```\n\n我们可以提出一个定制的navigation组件来,在用到的地方引入使用即可：\n```js\nimport Taro from '@tarojs/taro'\nimport { View, Image } from '@tarojs/components'\nimport { observer } from 'mobx-react-lite'\nimport { useRootStore } from '../store'\n\nimport returnBack from \"../resource/return_back.png\"\n\nconst Navigation = observer(({title, showback}) =\u003e {\n  const { screen } = useRootStore()\n\n  const goBackBtn = () =\u003e {\n    Taro.navigateBack()\n  }\n\n  return (\n    \u003c\u003e\n      \u003cView\n        className='custom-navigation'\n        style={{\n          left: `${screen.menuButtonRightWidth}px`,\n          top: `${screen.menuButtonTop}px`,\n          height: `${screen.menuButtonHeight}px`,\n          width: `${screen.navigationWidth}px`,\n        }}\u003e\n        {\n          showback ? \u003cView className=\"back-btn\" onClick={() =\u003e goBackBtn()}\u003e\u003cImage src={returnBack} className=\"icon-36-50\" /\u003e\u003c/View\u003e : null\n        }\n        \u003cView className='fixed font36 bold white center width100'\u003e{title}\u003c/View\u003e\n      \u003c/View\u003e\n      \u003cView style={{height: `${screen.navigationHeight}px`}}\u003e\u003c/View\u003e\n    \u003c/\u003e\n  )\n})\n\nexport default Navigation\n```\n\n以上就是主要代码和逻辑；大体流程就是，\n1. 通过mobx管理，使用微信给的接口获取navigation需要相关信息\n2. 封装上下文\n3. 通过上下文把信息传递给需要使用信息的组件\n\n","title":"微信小程序定制Navigation","slug":"weapp-custom-navigation","intro":"通过","tags":"taro, 微信小程序, 定制Navigation, mobx","date":"2023-12-04"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"weapp-custom-navigation"},"buildId":"4plFcxwAT7sB-HsrHNZDb","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>