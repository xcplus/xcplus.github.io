<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Turbo Rails的使用方法</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/6b7407e5a7346cc0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6b7407e5a7346cc0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-266da34e2468c883.js" defer=""></script><script src="/_next/static/chunks/framework-281bd828f4ecdac7.js" defer=""></script><script src="/_next/static/chunks/main-5712a0d871ba0756.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5aa6660ad80e5004.js" defer=""></script><script src="/_next/static/chunks/720-cfd8b9301b1b5f7f.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-e8b991116ca82f6d.js" defer=""></script><script src="/_next/static/GQsoFarA2TsxzMw8H5GBP/_buildManifest.js" defer=""></script><script src="/_next/static/GQsoFarA2TsxzMw8H5GBP/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex justify-center"><div class="fixed top-4 bg-white z-20 rounded-full dark:bg-slate-800"><nav class="px-2 py-2 flex rounded-full items-center font-semibold bg-transparent shadow-lg dark:shadow-md dark:shadow-slate-800"><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/">首页</a><a class="nav_link bg-indigo-700 rounded-full text-white" href="/articles">文章</a><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/projects">项目</a><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/about">关于</a></nav></div></div><div class="app antialiased pt-28"><div class="mx-6 sm:mx-16 flex-1 max-w-full"><div class="px-1"><div class="flex flex-col justify-center items-center gap-4 px-2"><div class=" font-extrabold text-2xl">Turbo Rails的使用方法</div><div class="flex gap-4"><div class=" font-medium text-slate-400 ">2023-06-09</div><div class="flex gap-2"><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->rails</span><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->turbo</span></div></div></div><div class="mt-4 tracking-wide leading-8 overflow-y-scroll mx-0 px-2 max-w-full prose lg:prose-xl dark:prose-invert"><h4>Turbo Drive</h4>
<p>默认情况下，Turbo Drive 通过将所有链接点击和表单提交转换为 AJAX 请求来加速我们的 Ruby on Rails 应用程序。</p>
<h5>Turbo Drive 是怎么工作的？</h5>
<p>Turbo Drive 的工作原理是拦截链接上的“点击”事件和表单上的“提交”事件。
每次单击链接时，Turbo Drive 都会拦截“单击”事件，通过将链接单击通常会触发的 HTML 请求转换为 AJAX 请求来覆盖默认行为。</p>
<p>当 Turbo Drive 收到响应时，它会将当前页面的 <!-- -->&lt;body&gt;<!-- --> 替换为响应的 <!-- -->&lt;body&gt;<!-- -->，在大多数情况下保持 <!-- -->&lt;head&gt;<!-- --> 不变</p>
<p>无效的表单提交必须返回 422 状态代码，以便 Turbo Drive 替换页面的 <!-- -->&lt;body&gt;<!-- --> 并显示表单错误。 Rails 中 422 状态代码的别名是：unprocessable_entity。</p>
<p>要在链接或表单上禁用 Turbo Drive，我们需要在其上添加 data-turbo=&quot;false&quot; 数据属性。</p>
<p>也可以为整个应用程序禁用 Turbo Drive，如下：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999">// app/javascript/application.js</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> </span><span class="token token imports maybe-class-name">Turbo</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&quot;@hotwired/turbo-rails&quot;</span><span>
</span><span></span><span class="token token maybe-class-name">Turbo</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">session</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">drive</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">false</span></code></div></pre>
<p>不建议全局关闭。</p>
<p>data-turbo-track=&quot;reload&quot;可以重载页面, 比如我们增加了新的css并且需要使用的人重载页面才可以加载</p>
<h4>Turbo Frame</h4>
<p>Turbo Frames 是网页的独立部分，无需完整的页面刷新和编写一行 JavaScript 即可附加、前置、替换或删除！</p>
<p>Turbo Frames 的一些规则:</p>
<ol>
<li>当点击 Turbo Frame 中的链接时，如果目标页面上有相同 id 的 frame，Turbo 会将源页面 Turbo Frame 的内容替换为目标页面 Turbo Frame 的内容。</li>
<li>当点击 Turbo Frame 内的链接时，如果目标页面上没有相同 id 的 Turbo Frame，Turbo 将从源页面中删除 Turbo Frame 的内容，并且在浏览器控制台中报错误 没有匹配的<!-- -->&lt;turbo-frame id=&quot;name_of_the_frame&quot;&gt;<!-- -->；</li>
<li>由于 data-turbo-frame 数据属性，链接可以指向它不直接嵌套的 Turbo Frame。在这种情况下，与源页面上的 data-turbo-frame 数据属性具有相同 id 的 Turbo Frame 将被替换为与目标页面上的 data-turbo-frame 数据属性具有相同 id 的 Turbo Frame。</li>
</ol>
<p>注意:
data-turbo-frame=&quot;_top&quot;, 使用“_top”关键字时，页面的 URL 会更改为目标页面的 URL, 替换整个页面，这是与使用常规 Turbo Frame 时的另一个不同之处。</p>
<h4>Turbo Stream</h4>
<p>turbo_stream 响应的方法，可以执行以下操作：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-ruby" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>  </span><span class="token token" style="color:#999"># 删除Turbo Frame</span><span>
</span><span>  turbo_stream</span><span class="token token" style="color:#ccc">.</span><span>remove
</span>
<span>  </span><span class="token token" style="color:#999"># 在列表的开头/结尾插入 Turbo Frame</span><span>
</span><span>  turbo_stream</span><span class="token token" style="color:#ccc">.</span><span>append
</span><span>  turbo_stream</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">prepend</span><span>
</span>
<span>  </span><span class="token token" style="color:#999"># Turbo Frame 之前/之后插入一个 Turbo Frame</span><span>
</span><span>  turbo_stream</span><span class="token token" style="color:#ccc">.</span><span>before
</span><span>  turbo_stream</span><span class="token token" style="color:#ccc">.</span><span>after
</span>
<span>  </span><span class="token token" style="color:#999"># 更新或替换 Turbo Frame 的内容</span><span>
</span><span>  turbo_stream</span><span class="token token" style="color:#ccc">.</span><span>update
</span><span>  turbo_stream</span><span class="token token" style="color:#ccc">.</span><span>replace</span></code></div></pre>
<p>通过结合使用 Turbo Frames 和新的 TURBO_STREAM 格式，我们将能够对网页的各个部分执行精确的操作，而无需编写一行 JavaScript，从而保留网页的状态。</p>
<h4>turbo_stream_from</h4>
<p>例如想在表User数据创建之后，想把这个数据即时更新到订阅的页面上则可以通过下面的例子操作：</p>
<ol>
<li>首页在A页面上添加订阅,以及A页面上该追加的地方</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-ruby" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999"># 订阅代码</span><span>
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">%=</span><span> turbo_stream_from </span><span class="token token string-literal" style="color:#7ec699">&quot;users&quot;</span><span> </span><span class="token token string-literal" style="color:#7ec699">%&gt; 
</span><span class="token token string-literal" style="color:#7ec699">
</span><span class="token token string-literal" style="color:#7ec699"># 对应追加的地方
</span><span class="token token string-literal" style="color:#7ec699">&lt;%= turbo_frame_tag &quot;user_list&quot; %&gt;</span><span>
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">%=</span><span> render </span><span class="token token" style="color:#7ec699">@users</span><span> </span><span class="token token string-literal" style="color:#7ec699">%&gt;
</span><span class="token token string-literal" style="color:#7ec699">&lt;% end %&gt;</span></code></div></pre>
<p>上面代码订阅了“users”流。</p>
<ol start="2">
<li>在表中添加创建之后推送代码:</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-ruby" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">class</span><span> </span><span class="token token" style="color:#f8c555">User</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span> ApplicationRecord
</span><span>  after_create_commit </span><span class="token token" style="color:#67cdcc">-</span><span class="token token" style="color:#67cdcc">&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span> broadcast_prepend_to </span><span class="token token string-literal" style="color:#7ec699">&quot;users&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f8c555">partial</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token string-literal" style="color:#7ec699">&quot;users/user&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f8c555">locals</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token" style="color:#f8c555">user</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#cc99cd">self</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f8c555">target</span><span class="token token" style="color:#67cdcc">:</span><span> &quot;user_list </span><span class="token token" style="color:#ccc">}</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">end</span></code></div></pre>
<p>这时候就会在创建成功后自动把数据插入到<code>user_list</code>内部的最前方.</p></div></div></div><footer class="w-full border-t mt-8"><div class="border-t border-salte-100 pb-8 pt-4 dark:border-slate-900"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-indigo-500" href="/articles">文章</a><a class="transition hover:text-indigo-500" href="/projects">项目</a><a class="transition hover:text-indigo-500" href="/about">关于</a></div><p class="text-sm text-zinc-400 dark:text-zinc-500">© 2023 Xcplus. 保留所有权.</p></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"articleData":{"markdownContent":"\n#### Turbo Drive\n默认情况下，Turbo Drive 通过将所有链接点击和表单提交转换为 AJAX 请求来加速我们的 Ruby on Rails 应用程序。\n\n##### Turbo Drive 是怎么工作的？\nTurbo Drive 的工作原理是拦截链接上的“点击”事件和表单上的“提交”事件。\n每次单击链接时，Turbo Drive 都会拦截“单击”事件，通过将链接单击通常会触发的 HTML 请求转换为 AJAX 请求来覆盖默认行为。\n\n当 Turbo Drive 收到响应时，它会将当前页面的 \u003cbody\u003e 替换为响应的 \u003cbody\u003e，在大多数情况下保持 \u003chead\u003e 不变\n\n无效的表单提交必须返回 422 状态代码，以便 Turbo Drive 替换页面的 \u003cbody\u003e 并显示表单错误。 Rails 中 422 状态代码的别名是：unprocessable_entity。\n\n要在链接或表单上禁用 Turbo Drive，我们需要在其上添加 data-turbo=\"false\" 数据属性。\n\n也可以为整个应用程序禁用 Turbo Drive，如下：\n```js\n// app/javascript/application.js\nimport { Turbo } from \"@hotwired/turbo-rails\"\nTurbo.session.drive = false\n```\n不建议全局关闭。\n\ndata-turbo-track=\"reload\"可以重载页面, 比如我们增加了新的css并且需要使用的人重载页面才可以加载\n\n\n#### Turbo Frame\nTurbo Frames 是网页的独立部分，无需完整的页面刷新和编写一行 JavaScript 即可附加、前置、替换或删除！\n\nTurbo Frames 的一些规则:\n1. 当点击 Turbo Frame 中的链接时，如果目标页面上有相同 id 的 frame，Turbo 会将源页面 Turbo Frame 的内容替换为目标页面 Turbo Frame 的内容。\n2. 当点击 Turbo Frame 内的链接时，如果目标页面上没有相同 id 的 Turbo Frame，Turbo 将从源页面中删除 Turbo Frame 的内容，并且在浏览器控制台中报错误 没有匹配的\u003cturbo-frame id=\"name_of_the_frame\"\u003e；\n3. 由于 data-turbo-frame 数据属性，链接可以指向它不直接嵌套的 Turbo Frame。在这种情况下，与源页面上的 data-turbo-frame 数据属性具有相同 id 的 Turbo Frame 将被替换为与目标页面上的 data-turbo-frame 数据属性具有相同 id 的 Turbo Frame。\n\n注意:\ndata-turbo-frame=\"_top\", 使用“_top”关键字时，页面的 URL 会更改为目标页面的 URL, 替换整个页面，这是与使用常规 Turbo Frame 时的另一个不同之处。\n\n#### Turbo Stream\n\nturbo_stream 响应的方法，可以执行以下操作：\n```ruby\n  # 删除Turbo Frame\n  turbo_stream.remove\n\n  # 在列表的开头/结尾插入 Turbo Frame\n  turbo_stream.append\n  turbo_stream.prepend\n\n  # Turbo Frame 之前/之后插入一个 Turbo Frame\n  turbo_stream.before\n  turbo_stream.after\n\n  # 更新或替换 Turbo Frame 的内容\n  turbo_stream.update\n  turbo_stream.replace\n```\n\n通过结合使用 Turbo Frames 和新的 TURBO_STREAM 格式，我们将能够对网页的各个部分执行精确的操作，而无需编写一行 JavaScript，从而保留网页的状态。\n\n#### turbo_stream_from\n例如想在表User数据创建之后，想把这个数据即时更新到订阅的页面上则可以通过下面的例子操作：\n1. 首页在A页面上添加订阅,以及A页面上该追加的地方\n```ruby\n# 订阅代码\n\u003c%= turbo_stream_from \"users\" %\u003e \n\n# 对应追加的地方\n\u003c%= turbo_frame_tag \"user_list\" %\u003e\n\u003c%= render @users %\u003e\n\u003c% end %\u003e\n```\n上面代码订阅了“users”流。\n\n2. 在表中添加创建之后推送代码:\n```ruby\nclass User \u003c ApplicationRecord\n  after_create_commit -\u003e { broadcast_prepend_to \"users\", partial: \"users/user\", locals: { user: self}, target: \"user_list }\nend\n```\n这时候就会在创建成功后自动把数据插入到`user_list`内部的最前方.","title":"Turbo Rails的使用方法","slug":"rails-turbo","intro":"turbo-drive、turbo-frame、turbo-stream的一些使用方法记录, turbo-rails库的强大功能编写响应式单页","tags":"rails, turbo","date":"2023-06-09","link":"https://www.hotrails.dev/turbo-rails"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"rails-turbo"},"buildId":"GQsoFarA2TsxzMw8H5GBP","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>