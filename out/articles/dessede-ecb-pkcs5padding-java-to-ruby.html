<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Ruby 实现 Java 中的&quot;DESede/ECB/PKCS5Padding&quot;的加密</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/ad614510aa32a8e8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ad614510aa32a8e8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-266da34e2468c883.js" defer=""></script><script src="/_next/static/chunks/framework-281bd828f4ecdac7.js" defer=""></script><script src="/_next/static/chunks/main-5712a0d871ba0756.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a764db188f6c844a.js" defer=""></script><script src="/_next/static/chunks/738-1c36df64be5a6fad.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-f2de61b5b871a88b.js" defer=""></script><script src="/_next/static/53nmWn7Z-FRMoDm1-0HzF/_buildManifest.js" defer=""></script><script src="/_next/static/53nmWn7Z-FRMoDm1-0HzF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex justify-center"><div class="fixed top-4 bg-white rounded-full dark:bg-slate-800"><nav class="px-2 py-2 flex rounded-full items-center font-semibold bg-transparent shadow-lg dark:shadow-md dark:shadow-slate-800"><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/">首页</a><a class="nav_link bg-indigo-700 rounded-full text-white" href="/articles">文章</a><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/projects">项目</a><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/about">关于</a></nav></div></div><div class="app antialiased pt-28"><div class="mx-6 sm:mx-16 flex-1 max-w-full"><div class="px-1"><div class="flex flex-col justify-center items-center gap-4 px-2"><div class=" font-extrabold text-2xl">Ruby 实现 Java 中的&quot;DESede/ECB/PKCS5Padding&quot;的加密</div><div class="flex gap-4"><div class=" font-medium text-slate-400 ">2020-10-11</div><div class="flex gap-2"><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->ruby</span><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->java</span><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->ecb加密</span></div></div></div><div class="mt-4 tracking-wide leading-8 overflow-y-scroll mx-0 px-2 max-w-full"><p>开发过程中，第三方SDK经常都是针对java、php、python、node.js的封装或者给出相应的事例，
而针对 Ruby 的很少，工作中遇到了ECB加密解密的需求，
下面给出Ruby 如何实现 Java 中的 ECB 加密解密的相关例子：</p>
<p>Java 代码1:</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#f8c555">Cipher</span><span> cipher </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f8c555">Cipher</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">getInstance</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;DESede/ECB/PKCS5Padding&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>cipher</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">init</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f8c555">Cipher</span><span class="token token" style="color:#ccc">.</span><span>ENCRYPT_MODE</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">SecretKeySpec</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">build3DesKey</span><span class="token token" style="color:#ccc">(</span><span>secretKey</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;DESede&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#f8c555">String</span><span> base64Encode </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">getBase64Encode</span><span class="token token" style="color:#ccc">(</span><span>cipher</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">doFinal</span><span class="token token" style="color:#ccc">(</span><span>src</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">getBytes</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;UTF-8&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>Java 代码2:</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">public</span><span> </span><span class="token token" style="color:#cc99cd">static</span><span> </span><span class="token token" style="color:#cc99cd">byte</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#f08d49">build3DesKey</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f8c555">String</span><span> keyStr</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">throws</span><span> </span><span class="token token" style="color:#f8c555">UnsupportedEncodingException</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">byte</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span> key </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#cc99cd">byte</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#f08d49">24</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">;</span><span>    </span><span class="token token" style="color:#999">//声明一个24位的字节数组，默认里面都是0</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">byte</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span> temp </span><span class="token token" style="color:#67cdcc">=</span><span> keyStr</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">getBytes</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;UTF-8&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>    </span><span class="token token" style="color:#999">//将字符串转成字节数组</span><span>
</span>
<span>  </span><span class="token token" style="color:#999">/*
</span><span class="token token" style="color:#999">  * 执行数组拷贝
</span><span class="token token" style="color:#999">  * System.arraycopy(源数组，从源数组哪里开始拷贝，目标数组，拷贝多少位)
</span><span class="token token" style="color:#999">  */</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">if</span><span class="token token" style="color:#ccc">(</span><span>key</span><span class="token token" style="color:#ccc">.</span><span>length </span><span class="token token" style="color:#67cdcc">&gt;</span><span> temp</span><span class="token token" style="color:#ccc">.</span><span>length</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#999">//如果temp不够24位，则拷贝temp数组整个长度的内容到key数组中</span><span>
</span><span>    </span><span class="token token" style="color:#f8c555">System</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">arraycopy</span><span class="token token" style="color:#ccc">(</span><span>temp</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">,</span><span> key</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">,</span><span> temp</span><span class="token token" style="color:#ccc">.</span><span>length</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#cc99cd">else</span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#999">//如果temp大于24位，则拷贝temp数组24个长度的内容到key数组中</span><span>
</span><span>    </span><span class="token token" style="color:#f8c555">System</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">arraycopy</span><span class="token token" style="color:#ccc">(</span><span>temp</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">,</span><span> key</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">,</span><span> key</span><span class="token token" style="color:#ccc">.</span><span>length</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span><span>  </span><span class="token token" style="color:#f8c555">System</span><span class="token token" style="color:#ccc">.</span><span>out</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">println</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;aaaaa&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#f8c555">System</span><span class="token token" style="color:#ccc">.</span><span>out</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">println</span><span class="token token" style="color:#ccc">(</span><span>key</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#f8c555">System</span><span class="token token" style="color:#ccc">.</span><span>out</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">println</span><span class="token token" style="color:#ccc">(</span><span>key</span><span class="token token" style="color:#ccc">.</span><span>length</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">for</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">int</span><span> i</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">;</span><span> i</span><span class="token token" style="color:#67cdcc">&lt;</span><span> key</span><span class="token token" style="color:#ccc">.</span><span>length </span><span class="token token" style="color:#ccc">;</span><span> i</span><span class="token token" style="color:#67cdcc">++</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#f8c555">System</span><span class="token token" style="color:#ccc">.</span><span>out</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">print</span><span class="token token" style="color:#ccc">(</span><span>key</span><span class="token token" style="color:#ccc">[</span><span>i</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span class="token token" style="color:#7ec699">&quot; &quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span><span>  </span><span class="token token" style="color:#f8c555">System</span><span class="token token" style="color:#ccc">.</span><span>out</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">println</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;aaaaa&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">return</span><span> key</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>ruby对应的加密解密</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-rb" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">require</span><span> </span><span class="token token string-literal" style="color:#7ec699">&#x27;base64&#x27;</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">require</span><span> </span><span class="token token string-literal" style="color:#7ec699">&#x27;digest&#x27;</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">require</span><span> </span><span class="token token string-literal" style="color:#7ec699">&#x27;openssl&#x27;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">module</span><span> </span><span class="token token" style="color:#f8c555">Des3Encrypt</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token method-definition" style="color:#cc99cd">self</span><span class="token token method-definition" style="color:#ccc">.</span><span class="token token method-definition" style="color:#f08d49">cipher</span><span class="token token" style="color:#ccc">(</span><span>mode</span><span class="token token" style="color:#ccc">,</span><span> key</span><span class="token token" style="color:#ccc">,</span><span> iv</span><span class="token token" style="color:#ccc">,</span><span> data</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    cipher </span><span class="token token" style="color:#67cdcc">=</span><span> OpenSSL</span><span class="token token double-colon" style="color:#ccc">::</span><span class="token token" style="color:#f8c555">Cipher</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">new</span><span class="token token" style="color:#ccc">(</span><span class="token token string-literal" style="color:#7ec699">&#x27;DES-EDE3&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>send</span><span class="token token" style="color:#ccc">(</span><span>mode</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    cipher</span><span class="token token" style="color:#ccc">.</span><span>key </span><span class="token token" style="color:#67cdcc">=</span><span> build_3des_key</span><span class="token token" style="color:#ccc">(</span><span>key</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    cipher</span><span class="token token" style="color:#ccc">.</span><span>iv  </span><span class="token token" style="color:#67cdcc">=</span><span> iv </span><span class="token token" style="color:#cc99cd">if</span><span> iv
</span>
<span>    encrypted </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token string-literal" style="color:#7ec699">&#x27;&#x27;</span><span>
</span><span>    encrypted </span><span class="token token" style="color:#67cdcc">&lt;&lt;</span><span> cipher</span><span class="token token" style="color:#ccc">.</span><span>update</span><span class="token token" style="color:#ccc">(</span><span>data</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    encrypted </span><span class="token token" style="color:#67cdcc">&lt;&lt;</span><span> cipher</span><span class="token token" style="color:#ccc">.</span><span>final
</span>    encrypted
<span>  </span><span class="token token" style="color:#cc99cd">end</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token method-definition" style="color:#cc99cd">self</span><span class="token token method-definition" style="color:#ccc">.</span><span class="token token method-definition" style="color:#f08d49">encrypt</span><span class="token token" style="color:#ccc">(</span><span>key</span><span class="token token" style="color:#ccc">,</span><span> iv</span><span class="token token" style="color:#ccc">,</span><span> data</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    Base64</span><span class="token token" style="color:#ccc">.</span><span>strict_encode64 cipher</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f8c555">:encrypt</span><span class="token token" style="color:#ccc">,</span><span> key</span><span class="token token" style="color:#ccc">,</span><span> iv</span><span class="token token" style="color:#ccc">,</span><span> data</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">end</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token method-definition" style="color:#cc99cd">self</span><span class="token token method-definition" style="color:#ccc">.</span><span class="token token method-definition" style="color:#f08d49">decrypt</span><span class="token token" style="color:#ccc">(</span><span>key</span><span class="token token" style="color:#ccc">,</span><span> iv</span><span class="token token" style="color:#ccc">,</span><span> data</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    cipher</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f8c555">:decrypt</span><span class="token token" style="color:#ccc">,</span><span> key</span><span class="token token" style="color:#ccc">,</span><span> iv</span><span class="token token" style="color:#ccc">,</span><span> Base64</span><span class="token token" style="color:#ccc">.</span><span>strict_decode64</span><span class="token token" style="color:#ccc">(</span><span>data</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">end</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token method-definition" style="color:#cc99cd">self</span><span class="token token method-definition" style="color:#ccc">.</span><span class="token token method-definition" style="color:#f08d49">build_3des_key</span><span class="token token" style="color:#ccc">(</span><span>key</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    key_bytes_length </span><span class="token token" style="color:#67cdcc">=</span><span> key</span><span class="token token" style="color:#ccc">.</span><span>bytes</span><span class="token token" style="color:#ccc">.</span><span>length
</span><span>    skey </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">if</span><span> key_bytes_length </span><span class="token token" style="color:#67cdcc">&lt;</span><span> </span><span class="token token" style="color:#f08d49">24</span><span>
</span><span>      key</span><span class="token token" style="color:#ccc">.</span><span>bytes </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">0.</span><span class="token token" style="color:#67cdcc">..</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">24</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span> key_bytes_length</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>to_a</span><span class="token token" style="color:#ccc">.</span><span>map</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#67cdcc">|</span><span>x</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">else</span><span>
</span><span>      key</span><span class="token token" style="color:#ccc">.</span><span>bytes</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#f08d49">0.</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#f08d49">.24</span><span class="token token" style="color:#ccc">]</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">end</span><span>
</span>
<span>    skey</span><span class="token token" style="color:#ccc">.</span><span>pack</span><span class="token token" style="color:#ccc">(</span><span class="token token string-literal" style="color:#7ec699">&quot;c*&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">end</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token method-definition" style="color:#cc99cd">self</span><span class="token token method-definition" style="color:#ccc">.</span><span class="token token method-definition" style="color:#f08d49">md5_capital</span><span class="token token" style="color:#ccc">(</span><span>str</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    Digest</span><span class="token token double-colon" style="color:#ccc">::</span><span class="token token" style="color:#f8c555">MD5</span><span class="token token" style="color:#ccc">.</span><span>hexdigest</span><span class="token token" style="color:#ccc">(</span><span>str</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>upcase
</span><span>  </span><span class="token token" style="color:#cc99cd">end</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">end</span></code></div></pre></div></div></div><footer class="w-full border-t mt-8"><div class="border-t border-salte-100 pb-8 pt-4 dark:border-slate-900"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-indigo-500" href="/articles">文章</a><a class="transition hover:text-indigo-500" href="/projects">项目</a><a class="transition hover:text-indigo-500" href="/about">关于</a></div><p class="text-sm text-zinc-400 dark:text-zinc-500">© 2023 Xcplus. 保留所有权.</p></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"articleData":{"markdownContent":"\n开发过程中，第三方SDK经常都是针对java、php、python、node.js的封装或者给出相应的事例，\n而针对 Ruby 的很少，工作中遇到了ECB加密解密的需求，\n下面给出Ruby 如何实现 Java 中的 ECB 加密解密的相关例子：\n\nJava 代码1:\n```java\nCipher cipher = Cipher.getInstance(\"DESede/ECB/PKCS5Padding\");\ncipher.init(Cipher.ENCRYPT_MODE, new SecretKeySpec(build3DesKey(secretKey), \"DESede\"));\nString base64Encode = getBase64Encode(cipher.doFinal(src.getBytes(\"UTF-8\")));\n```\n\n\nJava 代码2:\n```java\npublic static byte[] build3DesKey(String keyStr) throws UnsupportedEncodingException {\n  byte[] key = new byte[24];    //声明一个24位的字节数组，默认里面都是0\n  byte[] temp = keyStr.getBytes(\"UTF-8\");    //将字符串转成字节数组\n\n  /*\n  * 执行数组拷贝\n  * System.arraycopy(源数组，从源数组哪里开始拷贝，目标数组，拷贝多少位)\n  */\n  if(key.length \u003e temp.length){\n    //如果temp不够24位，则拷贝temp数组整个长度的内容到key数组中\n    System.arraycopy(temp, 0, key, 0, temp.length);\n  }else{\n    //如果temp大于24位，则拷贝temp数组24个长度的内容到key数组中\n    System.arraycopy(temp, 0, key, 0, key.length);\n  }\n  System.out.println(\"aaaaa\");\n  System.out.println(key);\n  System.out.println(key.length);\n  for(int i=0; i\u003c key.length ; i++) {\n    System.out.print(key[i] +\" \");\n  }\n  System.out.println(\"aaaaa\");\n  return key;\n}\n```\n\nruby对应的加密解密\n\n```rb\nrequire 'base64'\nrequire 'digest'\nrequire 'openssl'\n\nmodule Des3Encrypt\n  def self.cipher(mode, key, iv, data)\n    cipher = OpenSSL::Cipher.new('DES-EDE3').send(mode)\n    cipher.key = build_3des_key(key)\n    cipher.iv  = iv if iv\n\n    encrypted = ''\n    encrypted \u003c\u003c cipher.update(data)\n    encrypted \u003c\u003c cipher.final\n    encrypted\n  end\n\n  def self.encrypt(key, iv, data)\n    Base64.strict_encode64 cipher(:encrypt, key, iv, data)\n  end\n\n  def self.decrypt(key, iv, data)\n    cipher(:decrypt, key, iv, Base64.strict_decode64(data))\n  end\n\n  def self.build_3des_key(key)\n    key_bytes_length = key.bytes.length\n    skey = if key_bytes_length \u003c 24\n      key.bytes + (0...(24 - key_bytes_length)).to_a.map{|x| 0}\n    else\n      key.bytes[0...24]\n    end\n\n    skey.pack(\"c*\")\n  end\n\n  def self.md5_capital(str)\n    Digest::MD5.hexdigest(str).upcase\n  end\nend\n```","title":"Ruby 实现 Java 中的\"DESede/ECB/PKCS5Padding\"的加密","slug":"dessede-ecb-pkcs5padding-java-to-ruby","intro":"开发过程中，第三方SDK经常都是针对java、php、python、node.js的封装或者给出相应的事例，而针对 Ruby 的很少，工作中遇到了ECB加密解密的需求，下面给出Ruby 如何实现 Java 中的 ECB 加密解密的相关例子","tags":"ruby, java, ecb加密","date":"2020-10-11"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"dessede-ecb-pkcs5padding-java-to-ruby"},"buildId":"53nmWn7Z-FRMoDm1-0HzF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>