<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>React中的各种hook的使用</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/6b7407e5a7346cc0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6b7407e5a7346cc0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-266da34e2468c883.js" defer=""></script><script src="/_next/static/chunks/framework-281bd828f4ecdac7.js" defer=""></script><script src="/_next/static/chunks/main-5712a0d871ba0756.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5aa6660ad80e5004.js" defer=""></script><script src="/_next/static/chunks/720-cfd8b9301b1b5f7f.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-e8b991116ca82f6d.js" defer=""></script><script src="/_next/static/tfNd22Ko64wEoloeBUZNi/_buildManifest.js" defer=""></script><script src="/_next/static/tfNd22Ko64wEoloeBUZNi/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex justify-center"><div class="fixed top-4 bg-white z-20 rounded-full dark:bg-slate-800"><nav class="px-2 py-2 flex rounded-full items-center font-semibold bg-transparent shadow-lg dark:shadow-md dark:shadow-slate-800"><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/">首页</a><a class="nav_link bg-indigo-700 rounded-full text-white" href="/articles">文章</a><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/projects">项目</a><a class="nav_link hover:bg-indigo-300 hover:rounded-full hover:text-stone-50" href="/about">关于</a></nav></div></div><div class="app antialiased pt-28"><div class="mx-6 sm:mx-16 flex-1 max-w-full"><div class="px-1"><div class="flex flex-col justify-center items-center gap-4 px-2"><div class=" font-extrabold text-2xl">React中的各种hook的使用</div><div class="flex gap-4"><div class=" font-medium text-slate-400 ">2023-07-03</div><div class="flex gap-2"><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->react</span><span class="px-2 py-0 leading-7 bg-purple-400 text-white rounded-full text-sm">#<!-- -->hooks</span></div></div></div><div class="mt-4 tracking-wide leading-8 overflow-y-scroll mx-0 px-2 max-w-full prose lg:prose-xl dark:prose-invert"><blockquote>
<p>一些hooks的解释以及用法</p>
</blockquote>
<h3>useState</h3>
<p>useState 是一个 Hook，它允许你在函数组件中添加和管理状态。在以前的类组件中，你需要使用 this.state 和 this.setState 来管理状态。而 useState Hook 使得函数组件中管理状态变得更加简单和直观。</p>
<p>useState 的作用：</p>
<ol>
<li>在函数组件中添加状态。</li>
<li>提供一个函数来改变状态。</li>
</ol>
<p>详细使用方法：</p>
<ol>
<li>首先，需要在组件顶部导入 useState：</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useState </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<ol start="2">
<li>在函数组件内部，使用 useState 初始化状态。useState 接受一个参数，即的初始值。useState 返回一个数组，包含两个元素：当前状态值和一个用于更新状态的函数。你可以使用数组解构语法将这两个值分别赋给变量。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>count</span><span class="token token" style="color:#ccc">,</span><span> set</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中，我们创建了一个名为 count 的状态变量，并将其初始值设置为 0。同时，我们得到了一个名为 setCount 的函数，用于更新 count 的值。</p>
<ol start="3">
<li>在组件中使用状态值和更新函数。你可以在 JSX 中直接使用状态值，并通过事件处理器调用更新函数来更新状态。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useState </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">Counter</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>count</span><span class="token token" style="color:#ccc">,</span><span> setCount</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token maybe-class-name">Count</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span>count</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>button onClick</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#f08d49">setCount</span><span class="token token" style="color:#ccc">(</span><span>count </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token maybe-class-name">Increment</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>button</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">Counter</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中，我们创建了一个简单的计数器组件。我们在 <!-- -->&lt;p&gt;<!-- --> 标签中显示 count 的值，并在按钮的 onClick 事件处理器中调用 setCount 函数来更新 count 的值。当用户点击按钮时，计数器的值会递增。</p>
<h3>useEffect</h3>
<p>useEffect 是一个 Hook，它允许你在函数组件中执行副作用操作，如数据获取、订阅或手动修改 DOM。useEffect 可以看作是、componentDidUpdate 和 componentWillUnmount 这三个生命周期方法的组合。</p>
<p>useEffect 的作用：</p>
<ol>
<li>在组件挂载（mount）和更新（update）时副作用操作。</li>
<li>在组件卸载（unmount）时执行清理操作。</li>
</ol>
<p>详细使用方法：</p>
<ol>
<li>首先，在组件顶部导入 useEffect：</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useEffect </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<ol start="2">
<li>在函数组件内部，使用 useEffect 定义副作用操作。useEffect 接受两个参数：一个函数和一个依赖数组。函数中包含副作用操作的逻辑，而依赖数组用于指定何时执行副作用。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#f08d49">useEffect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#999">// 副作用操作</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span>dependencies</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<ol start="3">
<li>在副作用函数中执行操作，并在需要时返回一个清理函数。清理函数会在组件卸载时执行，用于取消订阅、清除定时器等。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports">useState</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useEffect</span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#f08d49">Example</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>data</span><span class="token token" style="color:#ccc">,</span><span> setData</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#f08d49">useEffect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">fetchData</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>      </span><span class="token token" style="color:#cc99cd">const</span><span> response </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token control-flow" style="color:#cc99cd">await</span><span> </span><span class="token token" style="color:#f08d49">fetch</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;https://api.example.com/data&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>      </span><span class="token token" style="color:#cc99cd">const</span><span> data </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token control-flow" style="color:#cc99cd">await</span><span> response</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">json</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>      </span><span class="token token" style="color:#f08d49">setData</span><span class="token token" style="color:#ccc">(</span><span>data</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>    </span><span class="token token" style="color:#f08d49">fetchData</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>    </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>      </span><span class="token token" style="color:#999">// 取消订阅或其他清理操作</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#999">// 依赖数组为空，表示仅在组件挂载时执行副作用</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#999">/* 渲染数据 */</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">Example</span></code></div></pre>
<p>在这个示例中，我们创建了一个名为 Example 的组件。我们使用 useState 定义了一个名为 data 的状态变量。然后，我们使用 useEffect 在组件挂载时获取数据，并在组件卸载时执行清理操作（如果需要）。</p>
<h3>useContext</h3>
<p>是一个 React Hook，它允许你在函数组件中读取和订阅 context。它可以让你在组件之间共享状态，而不必显式地通过组件的逐层传递 props。在复杂的使用场景中，你可以将多个 context 结合使用，以便更好地组织和管理状态。</p>
<p>以下是使用 useContext 的详细步骤：</p>
<ol>
<li>创建一个 Context 对象：首先，你需要使用 `React.createContext 创建一个 Context 对象。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token maybe-class-name">UserContext</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token maybe-class-name">React</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">createContext</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token maybe-class-name">ThemeContext</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token maybe-class-name">React</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">createContext</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<ol start="2">
<li>使用 Context.Provider：为了在组件树中提供 context，你需要使用 UserContext.Provider 和 ThemeContext.Provider 组件并传递 value 属性</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">UserContext</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;./UserContext&#x27;</span><span class="token token" style="color:#ccc">;</span><span> 
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">ThemeContext</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;./ThemeContext&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">App</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> user </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token literal-property" style="color:#f8c555">name</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;John Doe&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>    </span><span class="token token literal-property" style="color:#f8c555">age</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#f08d49">30</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> theme </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token literal-property" style="color:#f8c555">color</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;dark&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>  </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">UserContext</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access maybe-class-name">Provider</span><span> value</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>user</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">ThemeContext</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access maybe-class-name">Provider</span><span> value</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>theme</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">ChildComponent</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">ThemeContext</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access maybe-class-name">Provider</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token maybe-class-name">UserContext</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access maybe-class-name">Provider</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<ol start="3">
<li>在子组件中使用 useContext：在需要访问 context 的子组件中，你可以使用 <code>useContext</code> Hook 来读取和订阅 context。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useContext </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">UserContext</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;./UserContext&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">ThemeContext</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;./ThemeContext&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">ChildComponent</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> user </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useContext</span><span class="token token" style="color:#ccc">(</span><span class="token token maybe-class-name">UserContext</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> theme </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useContext</span><span class="token token" style="color:#ccc">(</span><span class="token token maybe-class-name">ThemeContext</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token maybe-class-name">Name</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span>user</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">name</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token maybe-class-name">Age</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span>user</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">age</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token maybe-class-name">Theme</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span>theme</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">color</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>在这个示例中，我们创建了两个 Context 对象：UserContext 和 ThemeContext。我们在 App 组件中使用两个 Context.Provider 组件来提供 user 和 theme 数据。然后，在 ChildComponent 中，我们使用 useContext 分别订阅这两个 context，以便在组件中使用它们。</p>
<h3>useReducer</h3>
<p>useReducer 是 React Hooks 中用于状态管理的一个 API，它是 useState 的替代方案，适用于处理更复杂的 state 管理场景。useReducer 的工作原理类似于 Redux，通过 dispatch 和 action 更新数据。</p>
<p>使用 useReducer 的基本步骤如下：</p>
<ol>
<li>定义一个 reducer 函数，它接收两个参数：当前的 state 和一个 action 对象。根据 action 的类型，reducer 函数会返回一个新的 state。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token" style="color:#f08d49">reducer</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">state</span><span class="token token parameter" style="color:#ccc">,</span><span class="token token parameter"> action</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">switch</span><span> </span><span class="token token" style="color:#ccc">(</span><span>action</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">type</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">case</span><span> </span><span class="token token" style="color:#7ec699">&#x27;ACTION_TYPE_1&#x27;</span><span class="token token" style="color:#67cdcc">:</span><span>
</span><span>      </span><span class="token token" style="color:#999">// 更新 state 的逻辑</span><span>
</span><span>      </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> newState</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">case</span><span> </span><span class="token token" style="color:#7ec699">&#x27;ACTION_TYPE_2&#x27;</span><span class="token token" style="color:#67cdcc">:</span><span>
</span><span>      </span><span class="token token" style="color:#999">// 更新 state 的逻辑</span><span>
</span><span>      </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> newState</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token module" style="color:#cc99cd">default</span><span class="token token" style="color:#67cdcc">:</span><span>
</span><span>      </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> state</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<ol start="2">
<li>在组件中使用 useReducer Hook。传入刚刚定义的 reducer 函数和初始 state。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useReducer </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">const</span><span> initialState </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token" style="color:#999">/* 初始 state 对象 */</span><span> </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">MyComponent</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>state</span><span class="token token" style="color:#ccc">,</span><span> dispatch</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useReducer</span><span class="token token" style="color:#ccc">(</span><span>reducer</span><span class="token token" style="color:#ccc">,</span><span> initialState</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#999">// 组件逻辑和渲染</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<ol start="3">
<li>在组件中使用 dispatch 函数来触发 action，从而更新 state。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token" style="color:#f08d49">handleAction</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#f08d49">dispatch</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token literal-property" style="color:#f8c555">type</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;ACTION_TYPE_1&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token literal-property" style="color:#f8c555">payload</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;some data&#x27;</span><span> </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>与 useState 相比，useReducer 更适合处理包含多个子值的 state 对象，尤其是当 state 变化逻辑较为复杂时。同时，useReducer 可以与 useContext 配合使用，实现类似 Redux 的全局状态管理功能。</p>
<h3>useCallback</h3>
<p>它允许你在组件重新渲染之间缓存函数定义。这对于避免不必要的子组件重新渲染非常有用，尤其是当子组件依赖于引用相等性来避免不必要的渲染时。</p>
<p>以下是使用 useCallback 的详细方法：</p>
<ol>
<li>在组件中引入 useCallback：</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useCallback </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<ol start="2">
<li>使用 useCallback 缓存函数定义。传入一个函数和一个依赖项数组。当依赖项发生变化时，useCallback 会一个新的缓存函数。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">const</span><span> memoizedCallback </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useCallback</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#999">// 函数逻辑</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span>dependency1</span><span class="token token" style="color:#ccc">,</span><span> dependency2</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<ol start="3">
<li>将缓存的回调函数传递给子组件。如果子组件使用了 React.memo 进行优化那么只有当回调函数的依赖项发生变化时，子组件才会重新渲染。</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useState</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useCallback </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">ChildComponent</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;./ChildComponent&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">ParentComponent</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>count</span><span class="token token" style="color:#ccc">,</span><span> setCount</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> incrementCount </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useCallback</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#f08d49">setCount</span><span class="token token" style="color:#ccc">(</span><span>count </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span>count</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">ChildComponent</span><span> onClick</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>incrementCount</span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token maybe-class-name">Count</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span>count</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">ParentComponent</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中，我们使用 useCallback 缓存了 incrementCount 函数。当 count 发生变化时，useCallback 会返回一个新的缓存函数。这样，只有当 count 发生变化时，ChildComponent 才会重新渲染。</p>
<p>需要注意的是，useCallback 本身并不会阻止函数的创建，而是在依赖项未发生变化时，返回缓存的函数。这有助于提高性能，尤其是在子组件依赖于回调函数引用相等性的情况下。</p>
<h3>useMemo</h3>
<p>它允许你在组件的多次渲染之间缓存计算结果。这有助于避免在每次渲染时都进行昂贵的计算从而提高性能。</p>
<ol>
<li>使用方法如下：</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">const</span><span> memoizedValue </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useMemo</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#f08d49">calculateValue</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span>dependencies</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>calculateValue 是一个函数，它包含你想要缓存的计算。dependencies 是一个数组，其中包含计算所依赖的变量。当这些依赖项发生变化时，useMemo 会重新计算值。</p>
<ol start="2">
<li>使用 useMemo 的示例：</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useState</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useMemo </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&quot;react&quot;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">App</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>number</span><span class="token token" style="color:#ccc">,</span><span> setNumber</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#999">// 使用 useMemo 缓存计算结果</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> squaredNumber </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useMemo</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#f08d49">squareNumber</span><span class="token token" style="color:#ccc">(</span><span>number</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span>number</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">onChangeHandler</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">e</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#f08d49">setNumber</span><span class="token token" style="color:#ccc">(</span><span>e</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">target</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">value</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div className</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;App&quot;</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>input
</span><span>        type</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;number&quot;</span><span>
</span><span>        placeholder</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;输入一个数字&quot;</span><span>
</span><span>        value</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>number</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>        onChange</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>onChangeHandler</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>输出：</span><span class="token token" style="color:#ccc">{</span><span>squaredNumber</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 计算平方的函数</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token" style="color:#f08d49">squareNumber</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">number</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token console" style="color:#f8c555">console</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">log</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;计算平方！&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token known-class-name" style="color:#f8c555">Math</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">pow</span><span class="token token" style="color:#ccc">(</span><span>number</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">2</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">App</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中，我们有一个输入框，用户可以输入一个数字。我们使用 useMemo 缓存平方计算的结果。当输入的数字发生变化时，useMemo 会重新计算平方值。这样，我们就避免了在每次渲染时都进行平方计算，从而提高了性能。</p>
<h3>useRef</h3>
<p>它允许你在组件中创建一个可变的引用对象。这个引用对象在组件的整个生命周期内保持不变。useRef 常用于访问 DOM 元素、存储上一次的状态值，以及在不触发重新渲染的情况下存储变量。</p>
<ol>
<li>使用方法如下：</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">const</span><span> ref </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useRef</span><span class="token token" style="color:#ccc">(</span><span>initialValue</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>initialValue 是引用对象的初始值。在后续渲染中，useRef 将返回相同的引用对象。</p>
<ol start="2">
<li>使用 useRef 的示例：</li>
</ol>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useRef </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&quot;react&quot;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">App</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> inputRef </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useRef</span><span class="token token" style="color:#ccc">(</span><span class="token token null nil" style="color:#cc99cd">null</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">onClickHandler</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    inputRef</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">focus</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div className</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;App&quot;</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>input ref</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>inputRef</span><span class="token token" style="color:#ccc">}</span><span> type</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;text&quot;</span><span> placeholder</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;输入文字&quot;</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>button onClick</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>onClickHandler</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>聚焦输入框</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>button</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">App</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中，我们有输入框和一个按钮。我们使用 useRef 创建一个引用对象，将其与输入框关联。当用户点击按钮时，输入框会获得焦点。这里，我们使用 useRef 来访问和操作 DOM 元素。</p>
<p>另一个使用 useRef 的场景是在不触发重新渲染的情况下存储变量。例如:</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useState</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useEffect</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useRef </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&quot;react&quot;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">App</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>count</span><span class="token token" style="color:#ccc">,</span><span> setCount</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> countRef </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useRef</span><span class="token token" style="color:#ccc">(</span><span>count</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#f08d49">useEffect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    countRef</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> count</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span>count</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">onClickHandler</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#f08d49">setCount</span><span class="token token" style="color:#ccc">(</span><span>count </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token console" style="color:#f8c555">console</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">log</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;上一次的计数值&quot;</span><span class="token token" style="color:#ccc">,</span><span> countRef</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div className</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;App&quot;</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>计数：</span><span class="token token" style="color:#ccc">{</span><span>count</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>button onClick</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>onClickHandler</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>增加计数</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>button</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">App</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中，我们使用 useState 管理计数值，并使用 useRef 存储上一次的计数值。当用户点击按钮时，计数值增加，同时我们可以在控制台输出上一次的计数值。这里，我们使用 useRef 在不触发重新渲染的情况下存储变。</p>
<h3>useImperativeHandle</h3>
<p>它允许你自定义由 ref 暴露给父组件的实例值。在大多数情况下，应当避免使用 这样的命令式代码。useImperativeHandle 应当与 forwardRef 一起使用。</p>
<p>使用 useImperativeHandle 的主要目的是让父组件能够访问并执行子件内的某些自定义函数（方法）。本质上，子组件将自己内部的函数（方法）通过 useImperativeHandle 添加到父组件中 useRef 定义的对象中.</p>
<ol>
<li>下面是一个简单的使用示例：</li>
</ol>
<p>父组件：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useRef </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">ChildComponent</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;./ChildComponent&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#f08d49">ParentComponent</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> childRef </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useRef</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">handleButtonClick</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    childRef</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">customMethod</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token maybe-class-name">ChildComponent</span><span> ref</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>childRef</span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>button onClick</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>handleButtonClick</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>调用子组件方法</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>button</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">ParentComponent</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>子组件：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> forwardRef</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useImperativeHandle </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#f08d49">ChildComponent</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">props</span><span class="token token parameter" style="color:#ccc">,</span><span class="token token parameter"> ref</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">customMethod</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token console" style="color:#f8c555">console</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">log</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;子组件的自定义方法被调用&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#f08d49">useImperativeHandle</span><span class="token token" style="color:#ccc">(</span><span>ref</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    custom</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>子组件</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token" style="color:#f08d49">forwardRef</span><span class="token token" style="color:#ccc">(</span><span class="token token maybe-class-name">ChildComponent</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中，父组件通过 useRef 创建了一个引用变量 childRef，并将其传递给子组件。子组件使用 forwardRef 接收父组件传递的 ref，并通过 useImperativeHandle 将子组件内定义的 customMethod 函数作为属性添加到父组件中的 ref 对象上。这，父组件就可以通过 childRef.current.customMethod() 调用子组件暴露给自己的函数。</p>
<h3>useLayoutEffect</h3>
<p>useLayoutEffect 是一个用于处理副作用的自定义钩子函数。它非常类似于 useEffect，但有一个重要的区别：useLayoutEffect 的副作用将会在 DOM 更新之后同步执行，但在浏览器进行绘制之前执行，这使得它适用于需要读取或操作 DOM 布局信息的情况。</p>
<p>useLayoutEffect 的作用是允许你在 React 更新 DOM 之后立即执行副作用，这对于需要在更新后立即访问 DOM 布局的情况非常有用。一些常见的用例包括：</p>
<ul>
<li>测量 DOM 元素的尺寸或位置。</li>
<li>执行需要读取 DOM 布局信息的动画或过渡效果。</li>
<li>调整 DOM 元素的样式或属性，以响应特定的布局更改。</li>
</ul>
<p>下面是 useLayoutEffect 的详细使用方法：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useLayoutEffect</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useRef </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">MyComponent</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> ref </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useRef</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#f08d49">useLayoutEffect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#999">// 在 DOM 更新后立即执行的副作用代码</span><span>
</span>
<span>    </span><span class="token token" style="color:#999">// 读取 DOM 元素的尺寸或位置</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">{</span><span> width</span><span class="token token" style="color:#ccc">,</span><span> height </span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> ref</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">getBoundingClientRect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token console" style="color:#f8c555">console</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">log</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;Element dimensions:&#x27;</span><span class="token token" style="color:#ccc">,</span><span> width</span><span class="token token" style="color:#ccc">,</span><span> height</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>    </span><span class="token token" style="color:#999">// 执行动画或过渡效果</span><span>
</span><span>    ref</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">style</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">transition</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&#x27;all 0.3s&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    ref</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">style</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">transform</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&#x27;scale(1.2)&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>    </span><span class="token token" style="color:#999">// 返回一个清理函数，可选</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>      </span><span class="token token" style="color:#999">// 在组件卸载或下一次副作用执行之前执行的清理代码</span><span>
</span><span>      ref</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">style</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">transition</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>      ref</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">current</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">style</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">transform</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span> </span><span class="token token" style="color:#999">// 传递一个空数组作为依赖项，以确保副作用只在组件首次渲染时执行</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div ref</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>ref</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token maybe-class-name">Hello</span><span class="token token" style="color:#ccc">,</span><span> world</span><span class="token token" style="color:#67cdcc">!</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>在上面的例子中，我们创建了一个函数式组件 MyComponent，使用 useRef 创建了一个 ref，并将其应用到 div 元素上。然后，我们使用 useLayoutEffect 创建一个副作用，该副作用在 DOM 更新后立即执行。</p>
<p>在副作用函数中，我们首先使用 getBoundingClientRect 方法读取了 div 元素的尺寸和位置信息，并将其输出到控制台。然后，我们设置了一些样式属性，实现了一个简单的缩放动画。</p>
<p>在最后，我们可以选择返回一个清理函数，它会在组件卸载或下一次副作用执行之前执行。在清理函数中，我们重置了之前设置的样式属性，以确保组件卸载或下一次副作用执行时的状态是正确的。</p>
<p>需要注意的是，由于 useLayoutEffect 在浏览器进行绘制之前同步执行，它可能会阻塞组件的渲染。因此，要谨慎使用 useLayoutEffect，并确保你的副作用代码是高效的，以免对性能产生负面影响。如果副作用代码不需要在浏览器绘制之前立即执行，你可以考虑使用 useEffect 代替。</p>
<h3>useDebugValue</h3>
<p>useDebugValue 是一个自定义钩子函数，用于在 React 开发工具中为自定义钩子提供额外的调试信息。它可以帮助开发者在 React DevTools 中更好地理解自定义钩子的用途和状态。</p>
<p>useDebugValue 的作用是允许你为自定义钩子提供一个自定义的调试值，以便在 React DevTools 中显示。通过这种方式，你可以为自定义钩子提供有意义的标签，帮助你更好地理解和调试你的代码。</p>
<p>下面是 useDebugValue 的详细使用方法：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useState</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useDebugValue </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token" style="color:#f08d49">useCustomHook</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">initialValue</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>value</span><span class="token token" style="color:#ccc">,</span><span> setValue</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span>initialValue</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#999">// 自定义钩子的逻辑...</span><span>
</span>
<span>  </span><span class="token token" style="color:#999">// 使用 useDebugValue 提供调试信息</span><span>
</span><span>  </span><span class="token token" style="color:#f08d49">useDebugValue</span><span class="token token" style="color:#ccc">(</span><span>value</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">value</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token template-string" style="color:#7ec699">Custom Hook Value: </span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">${</span><span class="token token template-string interpolation">value</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#ccc">}</span><span class="token token template-string template-punctuation" style="color:#7ec699">`</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> value</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">MyComponent</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> customValue </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useCustomHook</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;Hello&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">{</span><span>customValue</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>在上面的例子中，我们创建了一个名为 useCustomHook 的自定义钩子函数。在这个自定义钩子函数内部，我们使用 useState 创建了一个状态变量 value，并返回了它。在自定义钩子函数的逻辑中，你可以根据需求添加其他的自定义逻辑。</p>
<p>在 useDebugValue 中，我们传递了 value 和一个回调函数。回调函数接收 value 作为参数，并返回一个用于调试的字符串。在这个例子中，我们将 Custom Hook Value: ${value} 作为调试信息返回。</p>
<p>然后，在 MyComponent 组件中，我们使用 useCustomHook 获取 customValue，并将其渲染在 <!-- -->&lt;div&gt;<!-- --> 中。</p>
<p>当你使用 React DevTools 查看 MyComponent 组件时，你将在自定义钩子的部分看到类似于 &quot;Custom Hook Value: Hello&quot; 的调试标签，这可以帮助你更好地理解和调试你的自定义钩子的状态和行为。</p>
<p>需要注意的是，useDebugValue 是一个开发工具函数，它不会影响实际的组件渲染逻辑，而仅仅提供了更好的调试体验。因此，当你完成调试时，可以安全地删除 useDebugValue 的调用，而不会对生产代码产生任何影响。</p>
<h3>useDeferredValue</h3>
<p>是 React 中的一个实验性 Hook，它的主要作用是在更新状态时，允许延迟某些值的更新。这对于优化性能和提高用户体验非常有用，特别是在处理大量数据或复杂计算时。</p>
<p>使用 useDeferredValue 的基本语法如下：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">const</span><span> deferredValue </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useDeferredValue</span><span class="token token" style="color:#ccc">(</span><span>value</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token literal-property" style="color:#f8c555">timeoutMs</span><span class="token token" style="color:#67cdcc">:</span><span> 延迟时间 </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>useDeferredValue 接受两个参数：需要延迟更新的值和一个配置对象。配置对象中的 timeoutMs 属性用于设置延迟时间（以毫秒为单位）。
以下是一个使用 useDeferredValue 的示例：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useState</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useDeferredValue </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">App</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>text</span><span class="token token" style="color:#ccc">,</span><span> setText</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>searchText</span><span class="token token" style="color:#ccc">,</span><span> setSearchText</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> deferredSearchText </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useDeferredValue</span><span class="token token" style="color:#ccc">(</span><span>searchText</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token literal-property" style="color:#f8c555">timeoutMs</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#f08d49">2000</span><span> </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">handleChange</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">event</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#f08d49">setText</span><span class="token token" style="color:#ccc">(</span><span>event</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">target</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">value</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token" style="color:#f08d49">setSearchText</span><span class="token token" style="color:#ccc">(</span><span>event</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">target</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">value</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>input type</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;text&quot;</span><span> value</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>text</span><span class="token token" style="color:#ccc">}</span><span> onChange</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>handleChange</span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>实时显示</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span>text</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>延迟显示</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#ccc">{</span><span>deferredSearchText</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">App</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中，我们使用 useDeferredValue 来延迟显示用户输入的搜索文本。当用户输入文本时，实时显示的文本会立即更新，而延迟显示的文本会在 2 秒后更新。这可以帮助我们在处理大量数据或复杂计算时，优化性能和提高用户体验。</p>
<p>请注意，useDeferredValue 目前仍处于实验阶段，因此在将来的 React 版本中可能会发生变化。在使用此 Hook 时，请确保您的应用程序使用了适当的 React 版本，并密切关注 React 团队的更新。</p>
<h3>useTransition</h3>
<p>它用于在组件之间进行平滑过渡。这对于创建动画和管理组件的进入和退出非常有用。useTransition 可以帮助您在组件切换时实现更好的用户体验。</p>
<p>使用 useTransition 的基本语法如下：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>startTransition</span><span class="token token" style="color:#ccc">,</span><span> isPending</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useTransition</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token literal-property" style="color:#f8c555">timeoutMs</span><span class="token token" style="color:#67cdcc">:</span><span> 过渡超时时间</span><span class="token token" style="color:#ccc">,</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>useTransition 返回一个包含两个元素的数组：startTransition 函数和 isPending 布尔值。startTransition 函数用于开始过渡，而 isPending 值表示过渡是否正在进行中。</p>
<p>以下是一个使用 useTransition 的示例：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports maybe-class-name">React</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useState</span><span class="token token imports" style="color:#ccc">,</span><span class="token token imports"> useTransition </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">App</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>isToggled</span><span class="token token" style="color:#ccc">,</span><span> setIsToggled</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useState</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">false</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token" style="color:#ccc">[</span><span>isPending</span><span class="token token" style="color:#ccc">,</span><span> startTransition</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useTransition</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span> </span><span class="token token literal-property" style="color:#f8c555">timeoutMs</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#f08d49">3000</span><span> </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#cc99cd">const</span><span> </span><span class="token token function-variable" style="color:#f08d49">handleClick</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#f08d49">startTransition</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>      </span><span class="token token" style="color:#f08d49">setIsToggled</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#67cdcc">!</span><span>isToggled</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>button onClick</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>handleClick</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>切换</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>button</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#ccc">{</span><span>isPending </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>过渡进行中</span><span class="token token spread" style="color:#67cdcc">...</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>      </span><span class="token token" style="color:#ccc">{</span><span>isToggled </span><span class="token token" style="color:#67cdcc">?</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>组件 </span><span class="token token" style="color:#f8c555">A</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span> </span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>组件 </span><span class="token token" style="color:#f8c555">B</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">}</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token maybe-class-name">App</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>在这个示例中我们使用 useTransition 来实现组件 A 和组件 B 之间的平滑过渡。当用户点击按钮时，startTransition 函数会触发过渡，并在 3 秒内完成。在过渡进行中，我们会显示一个提示消息。
请注意，useTransition 目前仍处于实验阶段，因此在将来的 React 版本中可能会发生变化。在使用此 Hook 时，请确保的应用程序使用了适当的 React 版本，并密切关注 React 团队的更新。</p>
<h3>useId</h3>
<p>用于生成传递给无障碍属性的唯一 ID。它的主要好处是 React 确保它能够与服务端渲染一起工作。在 React 中直接编写 ID 并不是一个好的习惯，因为一个组件可能会在页面上渲染多次，但是 ID 必须是唯一的。使用 useId 可以生成唯一的 ID，避免这个问题。</p>
<p>用法示例：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useId </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">PasswordField</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> passwordHintId </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useId</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>label</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>        </span><span class="token token literal-property" style="color:#f8c555">密码</span><span class="token token" style="color:#67cdcc">:</span><span>
</span><span>        </span><span class="token token" style="color:#67cdcc">&lt;</span><span>input type</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;password&quot;</span><span> aria</span><span class="token token" style="color:#67cdcc">-</span><span>describedby</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>passwordHintId</span><span class="token token" style="color:#ccc">}</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>label</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p id</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>passwordHintId</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>密码应该包含至少 </span><span class="token token" style="color:#f08d49">18</span><span> 个字符</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>在这个示例中，我们使用 useId 生成一个唯一的 ID，并将其分配给 passwordHintId。然后，我们将此 ID 用作 input 元素的 aria-describedby 属性值，以及相关提示文本的 id 属性值。</p>
<p>如果你需要为多个相关元素生成 ID，可以调用 useId 来为它们生成共同的前缀：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useId </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token module" style="color:#cc99cd">export</span><span> </span><span class="token token module" style="color:#cc99cd">default</span><span> </span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">Form</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> id </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useId</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>form</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>label htmlFor</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>id </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#7ec699">&#x27;-firstName&#x27;</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>名字：</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>label</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>input id</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>id </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#7ec699">&#x27;-firstName&#x27;</span><span class="token token" style="color:#ccc">}</span><span> type</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;text&quot;</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>hr </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>label htmlFor</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>id </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#7ec699">&#x27;-lastName&#x27;</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&gt;</span><span>姓氏：</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>label</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>      </span><span class="token token" style="color:#67cdcc">&lt;</span><span>input id</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">{</span><span>id </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#7ec699">&#x27;-lastName&#x27;</span><span class="token token" style="color:#ccc">}</span><span> type</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;text&quot;</span><span> </span><span class="token token" style="color:#67cdcc">/</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>form</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>在这个示例中，我们使用 useId 生成一个唯一的 ID，并将其分配给 id。然后，我们为名字和姓氏输入框添加相应的后缀，以创建唯一的 ID。</p>
<h3>useSyncExternalStore</h3>
<p>useSyncExternalStore 是 React 18 中引入的一个新 Hook，主要用于解决外部数据源的撕裂问题。它通常用于第三方状态管理库，如 Redux，以确保在并发渲染期间数据保持一致。在日常业务中，我们通常不需要关注这个 Hook，因为 React 的 useState 已经原生解决了并发特性下的撕裂问题。然而，对于框架开发者来说，useSyncStore 提供了一个有用的 API，以便更好地集成外部状态管理库。</p>
<p>useSyncExternalStore 的基本用法如下：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">const</span><span> state </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useSyncExternal</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>  subscribe</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>  getSnapshot</span><span class="token token" style="color:#ccc">,</span><span>
</span>  getServerSnapshot
<span></span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span></code></div></pre>
<p>subscribe：一个订阅函数，用于监听外部数据源的变化。当数据发生变化时，订阅函数应该通知 React 重新渲组件。</p>
<p>getSnapshot：一个获取当前数据快照的函数。这个函数应该返回外部数据源的当前状态。</p>
<p>getServerSnapshot：一个可选的函数，用于获取服务端渲染时的数据快照。这个函数在客户端渲染时不会被调用。</p>
<p>以下是一个简单的示例，展示了如何使用 useSyncExternalStore：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports"> useSyncExternalStore </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 假设我们有一个外部数据源</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">const</span><span> externalStore </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token literal-property" style="color:#f8c555">data</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#7ec699">&#x27;Hello, world!&#x27;</span><span class="token token" style="color:#ccc">,</span><span>
</span><span>  </span><span class="token token literal-property" style="color:#f8c555">listeners</span><span class="token token" style="color:#67cdcc">:</span><span> </span><span class="token token" style="color:#cc99cd">new</span><span> </span><span class="token token" style="color:#f8c555">Set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 订阅函数</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token" style="color:#f08d49">subscribe</span><span class="token token" style="color:#ccc">(</span><span class="token token parameter">callback</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  externalStore</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">listeners</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">add</span><span class="token token" style="color:#ccc">(</span><span>callback</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    externalStore</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">listeners</span><span class="token token" style="color:#ccc">.</span><span class="token token method property-access" style="color:#f08d49">delete</span><span class="token token" style="color:#ccc">(</span><span>callback</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token" style="color:#999">// 获取数据快照的函数</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token" style="color:#f08d49">getSnapshot</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> externalStore</span><span class="token token" style="color:#ccc">.</span><span class="token token property-access">data</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">App</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#cc99cd">const</span><span> data </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">useSyncExternalStore</span><span class="token token" style="color:#ccc">(</span><span>subscribe</span><span class="token token" style="color:#ccc">,</span><span> getSnapshot</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#67cdcc">&lt;</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">{</span><span>data</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">/</span><span>div</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#ccc">;</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span></code></div></pre>
<p>在这个示例中，我们使用 useSyncExternalStore 来订阅一个外部数据源，并在数据发生变化时重新渲染组件。请注意，这个示例仅用于演示目的，实际上你可能会使用像 Redux 这样的状态管理库来处理外部数据源。
React-Redux 8.0 已经基于 useSyncExternalStore 进行了实现，因此如果你使用 Redux，你可以直接使用新版本的 React-Redux 来获得与 React 18 的并发特性兼容的状态管理。</p>
<h3>useInsertionEffect</h3>
<p>useInsertionEffect 是一个新的 React 钩子，它主要用于解决 CSS-in-JS 库在渲染过程中注入样式的性能问题。这个钩子在 DOM 发生变化之后运行，但在布局效果读取新布局之前。这解决了 React 17 及更低版本中已经存在的问题，但在 React 18 中更为重要，因为 React 在并发渲染期间会屈服于浏览器，使其有机会重新计算布局。</p>
<p>通常情况下，除你正在构建一个 CSS-in-JS 库，否则不建议使用 useInsertionEffect。这是因为它主要针对 CSS-in-JS 库的性能优化。</p>
<p>使用方法如下：</p>
<pre><div style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-javascript" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#cc99cd">import</span><span> </span><span class="token token imports" style="color:#ccc">{</span><span class="token token imports maybe-class-name">InsertionEffect</span><span class="token token imports"> </span><span class="token token imports" style="color:#ccc">}</span><span> </span><span class="token token module" style="color:#cc99cd">from</span><span> </span><span class="token token" style="color:#7ec699">&#x27;react&#x27;</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">function</span><span> </span><span class="token token maybe-class-name" style="color:#f08d49">MyComponent</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>  </span><span class="token token" style="color:#f08d49">useInsertionEffect</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token arrow" style="color:#67cdcc">=&gt;</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#999">// 在这里插入样式或执行与样式相关的操作</span><span>
</span><span>  </span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#999">// 组件的其他逻辑和渲染</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span></code></div></pre>
<p>useInsertionEffect 的回调函数中，你可以执行与样式相关的操作，例如插入样式或修改现有样式。这个钩子会确保在 DOM 发生变化后，但在布局效果读取新布局之前执行这些操作，从而提高性能</p></div></div></div><footer class="w-full border-t mt-8"><div class="border-t border-salte-100 pb-8 pt-4 dark:border-slate-900"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-indigo-500" href="/articles">文章</a><a class="transition hover:text-indigo-500" href="/projects">项目</a><a class="transition hover:text-indigo-500" href="/about">关于</a></div><p class="text-sm text-zinc-400 dark:text-zinc-500">© 2023 Xcplus. 保留所有权.</p></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"articleData":{"markdownContent":"\n\u003e 一些hooks的解释以及用法\n\n### useState\nuseState 是一个 Hook，它允许你在函数组件中添加和管理状态。在以前的类组件中，你需要使用 this.state 和 this.setState 来管理状态。而 useState Hook 使得函数组件中管理状态变得更加简单和直观。\n\nuseState 的作用：\n1. 在函数组件中添加状态。\n2. 提供一个函数来改变状态。\n\n详细使用方法：\n1. 首先，需要在组件顶部导入 useState：\n```javascript\nimport React, { useState } from 'react';\n```\n\n2. 在函数组件内部，使用 useState 初始化状态。useState 接受一个参数，即的初始值。useState 返回一个数组，包含两个元素：当前状态值和一个用于更新状态的函数。你可以使用数组解构语法将这两个值分别赋给变量。\n```javascript\nconst [count, set] = useState(0);\n```\n在这个示例中，我们创建了一个名为 count 的状态变量，并将其初始值设置为 0。同时，我们得到了一个名为 setCount 的函数，用于更新 count 的值。\n\n3. 在组件中使用状态值和更新函数。你可以在 JSX 中直接使用状态值，并通过事件处理器调用更新函数来更新状态。\n```javascript\nimport React, { useState } from 'react';\n\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  return (\n    \u003cdiv\u003e\n      \u003cp\u003eCount: {count}\u003c/p\u003e\n      \u003cbutton onClick={() =\u003e setCount(count + 1)}\u003eIncrement\u003c/button\u003e\n    \u003c/div\u003e\n  );\n}\n\nexport default Counter;\n```\n在这个示例中，我们创建了一个简单的计数器组件。我们在 \u003cp\u003e 标签中显示 count 的值，并在按钮的 onClick 事件处理器中调用 setCount 函数来更新 count 的值。当用户点击按钮时，计数器的值会递增。\n\n### useEffect\nuseEffect 是一个 Hook，它允许你在函数组件中执行副作用操作，如数据获取、订阅或手动修改 DOM。useEffect 可以看作是、componentDidUpdate 和 componentWillUnmount 这三个生命周期方法的组合。\n\nuseEffect 的作用：\n1. 在组件挂载（mount）和更新（update）时副作用操作。\n2. 在组件卸载（unmount）时执行清理操作。\n\n详细使用方法：\n1. 首先，在组件顶部导入 useEffect：\n```javascript\nimport React, { useEffect } from 'react';\n```\n2. 在函数组件内部，使用 useEffect 定义副作用操作。useEffect 接受两个参数：一个函数和一个依赖数组。函数中包含副作用操作的逻辑，而依赖数组用于指定何时执行副作用。\n```javascript\nuseEffect(() =\u003e {\n  // 副作用操作\n}, [dependencies])\n```\n\n3. 在副作用函数中执行操作，并在需要时返回一个清理函数。清理函数会在组件卸载时执行，用于取消订阅、清除定时器等。\n```javascript\nimport React, {useState, useEffect} from 'react'\nconst Example = () =\u003e {\n  const [data, setData] = useState([]);\n\n  useEffect(()=\u003e{\n    const fetchData = async () =\u003e {\n      const response = await fetch('https://api.example.com/data');\n      const data = await response.json();\n      setData(data);\n    };\n\n    fetchData();\n\n    return () =\u003e {\n      // 取消订阅或其他清理操作\n    };\n  }, []) // 依赖数组为空，表示仅在组件挂载时执行副作用\n\n  return (\n    \u003cdiv\u003e\n      {/* 渲染数据 */}\n    \u003c/div\u003e\n  );\n}\n\nexport default Example\n```\n在这个示例中，我们创建了一个名为 Example 的组件。我们使用 useState 定义了一个名为 data 的状态变量。然后，我们使用 useEffect 在组件挂载时获取数据，并在组件卸载时执行清理操作（如果需要）。\n\n\n### useContext\n是一个 React Hook，它允许你在函数组件中读取和订阅 context。它可以让你在组件之间共享状态，而不必显式地通过组件的逐层传递 props。在复杂的使用场景中，你可以将多个 context 结合使用，以便更好地组织和管理状态。\n\n以下是使用 useContext 的详细步骤：\n1. 创建一个 Context 对象：首先，你需要使用 `React.createContext 创建一个 Context 对象。\n```javascript\nimport React from 'react';\nconst UserContext = React.createContext();\nconst ThemeContext = React.createContext();\n```\n\n2. 使用 Context.Provider：为了在组件树中提供 context，你需要使用 UserContext.Provider 和 ThemeContext.Provider 组件并传递 value 属性\n```javascript \nimport UserContext from './UserContext'; \nimport ThemeContext from './ThemeContext';\nfunction App() {\n  const user = {\n    name: 'John Doe',\n    age: 30,\n  };\n  const theme = {\n    color: 'dark',\n  };\n  return (\n  \u003cUserContext.Provider value={user}\u003e\n    \u003cThemeContext.Provider value={theme}\u003e\n      \u003cChildComponent /\u003e\n    \u003c/ThemeContext.Provider\u003e\n  \u003c/UserContext.Provider\u003e\n  );\n}\n```\n3. 在子组件中使用 useContext：在需要访问 context 的子组件中，你可以使用 `useContext` Hook 来读取和订阅 context。\n\n```javascript\nimport React, { useContext } from 'react';\nimport UserContext from './UserContext';\nimport ThemeContext from './ThemeContext';\n\nfunction ChildComponent() {\n  const user = useContext(UserContext);\n  const theme = useContext(ThemeContext);\n\n  return (\n    \u003cdiv\u003e\n      \u003cp\u003eName: {user.name}\u003c/p\u003e\n      \u003cp\u003eAge: {user.age}\u003c/p\u003e\n      \u003cp\u003eTheme: {theme.color}\u003c/p\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n在这个示例中，我们创建了两个 Context 对象：UserContext 和 ThemeContext。我们在 App 组件中使用两个 Context.Provider 组件来提供 user 和 theme 数据。然后，在 ChildComponent 中，我们使用 useContext 分别订阅这两个 context，以便在组件中使用它们。\n\n### useReducer\nuseReducer 是 React Hooks 中用于状态管理的一个 API，它是 useState 的替代方案，适用于处理更复杂的 state 管理场景。useReducer 的工作原理类似于 Redux，通过 dispatch 和 action 更新数据。\n\n使用 useReducer 的基本步骤如下：\n1. 定义一个 reducer 函数，它接收两个参数：当前的 state 和一个 action 对象。根据 action 的类型，reducer 函数会返回一个新的 state。\n```javascript\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'ACTION_TYPE_1':\n      // 更新 state 的逻辑\n      return newState;\n    case 'ACTION_TYPE_2':\n      // 更新 state 的逻辑\n      return newState;\n    default:\n      return state;\n  }\n}\n```\n\n2. 在组件中使用 useReducer Hook。传入刚刚定义的 reducer 函数和初始 state。\n```javascript\nimport React, { useReducer } from 'react';\n\nconst initialState = { /* 初始 state 对象 */ };\n\nfunction MyComponent() {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  // 组件逻辑和渲染\n}\n```\n\n3. 在组件中使用 dispatch 函数来触发 action，从而更新 state。\n```javascript\nfunction handleAction() {\n  dispatch({ type: 'ACTION_TYPE_1', payload: 'some data' });\n}\n```\n\n与 useState 相比，useReducer 更适合处理包含多个子值的 state 对象，尤其是当 state 变化逻辑较为复杂时。同时，useReducer 可以与 useContext 配合使用，实现类似 Redux 的全局状态管理功能。\n\n### useCallback\n它允许你在组件重新渲染之间缓存函数定义。这对于避免不必要的子组件重新渲染非常有用，尤其是当子组件依赖于引用相等性来避免不必要的渲染时。\n\n以下是使用 useCallback 的详细方法：\n1. 在组件中引入 useCallback：\n```javascript\nimport React, { useCallback } from 'react';\n```\n\n2. 使用 useCallback 缓存函数定义。传入一个函数和一个依赖项数组。当依赖项发生变化时，useCallback 会一个新的缓存函数。\n```javascript\nconst memoizedCallback = useCallback(() =\u003e {\n  // 函数逻辑\n}, [dependency1, dependency2]);\n```\n\n3. 将缓存的回调函数传递给子组件。如果子组件使用了 React.memo 进行优化那么只有当回调函数的依赖项发生变化时，子组件才会重新渲染。\n```javascript\nimport React, { useState, useCallback } from 'react';\nimport ChildComponent from './ChildComponent';\n\nfunction ParentComponent() {\n  const [count, setCount] = useState(0);\n\n  const incrementCount = useCallback(() =\u003e {\n    setCount(count + 1);\n  }, [count]);\n\n  return (\n    \u003cdiv\u003e\n      \u003cChildComponent onClick={incrementCount} /\u003e\n      \u003cp\u003eCount: {count}\u003c/p\u003e\n    \u003c/div\u003e\n  );\n}\n\nexport default ParentComponent;\n```\n\n在这个示例中，我们使用 useCallback 缓存了 incrementCount 函数。当 count 发生变化时，useCallback 会返回一个新的缓存函数。这样，只有当 count 发生变化时，ChildComponent 才会重新渲染。\n\n需要注意的是，useCallback 本身并不会阻止函数的创建，而是在依赖项未发生变化时，返回缓存的函数。这有助于提高性能，尤其是在子组件依赖于回调函数引用相等性的情况下。\n\n### useMemo\n\n它允许你在组件的多次渲染之间缓存计算结果。这有助于避免在每次渲染时都进行昂贵的计算从而提高性能。\n\n1. 使用方法如下：\n```javascript\nconst memoizedValue = useMemo(() =\u003e calculateValue(), [dependencies]);\n```\ncalculateValue 是一个函数，它包含你想要缓存的计算。dependencies 是一个数组，其中包含计算所依赖的变量。当这些依赖项发生变化时，useMemo 会重新计算值。\n\n2. 使用 useMemo 的示例：\n```javascript\nimport React, { useState, useMemo } from \"react\";\n\nfunction App() {\n  const [number, setNumber] = useState(0);\n\n  // 使用 useMemo 缓存计算结果\n  const squaredNumber = useMemo(() =\u003e {\n    return squareNumber(number);\n  }, [number]);\n\n  const onChangeHandler = (e) =\u003e {\n    setNumber(e.target.value);\n  };\n\n  return (\n    \u003cdiv className=\"App\"\u003e\n      \u003cinput\n        type=\"number\"\n        placeholder=\"输入一个数字\"\n        value={number}\n        onChange={onChangeHandler}\n      /\u003e\n      \u003cdiv\u003e输出：{squaredNumber}\u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n\n// 计算平方的函数\nfunction squareNumber(number) {\n  console.log(\"计算平方！\");\n  return Math.pow(number, 2);\n}\n\nexport default App;\n```\n\n在这个示例中，我们有一个输入框，用户可以输入一个数字。我们使用 useMemo 缓存平方计算的结果。当输入的数字发生变化时，useMemo 会重新计算平方值。这样，我们就避免了在每次渲染时都进行平方计算，从而提高了性能。\n\n### useRef\n它允许你在组件中创建一个可变的引用对象。这个引用对象在组件的整个生命周期内保持不变。useRef 常用于访问 DOM 元素、存储上一次的状态值，以及在不触发重新渲染的情况下存储变量。\n\n1. 使用方法如下：\n```javascript\nconst ref = useRef(initialValue);\n```\ninitialValue 是引用对象的初始值。在后续渲染中，useRef 将返回相同的引用对象。\n\n2. 使用 useRef 的示例：\n```javascript\nimport React, { useRef } from \"react\";\n\nfunction App() {\n  const inputRef = useRef(null);\n\n  const onClickHandler = () =\u003e {\n    inputRef.current.focus();\n  };\n\n  return (\n    \u003cdiv className=\"App\"\u003e\n      \u003cinput ref={inputRef} type=\"text\" placeholder=\"输入文字\" /\u003e\n      \u003cbutton onClick={onClickHandler}\u003e聚焦输入框\u003c/button\u003e\n    \u003c/div\u003e\n  );\n}\n\nexport default App;\n```\n在这个示例中，我们有输入框和一个按钮。我们使用 useRef 创建一个引用对象，将其与输入框关联。当用户点击按钮时，输入框会获得焦点。这里，我们使用 useRef 来访问和操作 DOM 元素。\n\n另一个使用 useRef 的场景是在不触发重新渲染的情况下存储变量。例如:\n```javascript\nimport React, { useState, useEffect, useRef } from \"react\";\n\nfunction App() {\n  const [count, setCount] = useState(0);\n  const countRef = useRef(count);\n\n  useEffect(() =\u003e {\n    countRef.current = count;\n  }, [count]);\n\n  const onClickHandler = () =\u003e {\n    setCount(count + 1);\n    console.log(\"上一次的计数值\", countRef.current);\n  };\n\n  return (\n    \u003cdiv className=\"App\"\u003e\n      \u003cdiv\u003e计数：{count}\u003c/div\u003e\n      \u003cbutton onClick={onClickHandler}\u003e增加计数\u003c/button\u003e\n    \u003c/div\u003e\n  );\n}\n\nexport default App;\n```\n\n在这个示例中，我们使用 useState 管理计数值，并使用 useRef 存储上一次的计数值。当用户点击按钮时，计数值增加，同时我们可以在控制台输出上一次的计数值。这里，我们使用 useRef 在不触发重新渲染的情况下存储变。\n\n### useImperativeHandle\n它允许你自定义由 ref 暴露给父组件的实例值。在大多数情况下，应当避免使用 这样的命令式代码。useImperativeHandle 应当与 forwardRef 一起使用。\n\n使用 useImperativeHandle 的主要目的是让父组件能够访问并执行子件内的某些自定义函数（方法）。本质上，子组件将自己内部的函数（方法）通过 useImperativeHandle 添加到父组件中 useRef 定义的对象中.\n\n1. 下面是一个简单的使用示例：\n\n父组件：\n```javascript\nimport React, { useRef } from 'react';\nimport ChildComponent from './ChildComponent';\n\nconst ParentComponent = () =\u003e {\n  const childRef = useRef();\n\n  const handleButtonClick = () =\u003e {\n    childRef.current.customMethod();\n  };\n\n  return (\n    \u003c\u003e\n      \u003cChildComponent ref={childRef} /\u003e\n      \u003cbutton onClick={handleButtonClick}\u003e调用子组件方法\u003c/button\u003e\n    \u003c/\u003e\n  );\n};\n\nexport default ParentComponent;\n```\n\n子组件：\n```javascript\nimport React, { forwardRef, useImperativeHandle } from 'react';\n\nconst ChildComponent = (props, ref) =\u003e {\n  const customMethod = () =\u003e {\n    console.log('子组件的自定义方法被调用');\n  };\n\n  useImperativeHandle(ref, () =\u003e ({\n    custom,\n  }));\n\n  return \u003cdiv\u003e子组件\u003c/div\u003e;\n};\n\nexport default forwardRef(ChildComponent);\n```\n\n在这个示例中，父组件通过 useRef 创建了一个引用变量 childRef，并将其传递给子组件。子组件使用 forwardRef 接收父组件传递的 ref，并通过 useImperativeHandle 将子组件内定义的 customMethod 函数作为属性添加到父组件中的 ref 对象上。这，父组件就可以通过 childRef.current.customMethod() 调用子组件暴露给自己的函数。\n\n### useLayoutEffect\nuseLayoutEffect 是一个用于处理副作用的自定义钩子函数。它非常类似于 useEffect，但有一个重要的区别：useLayoutEffect 的副作用将会在 DOM 更新之后同步执行，但在浏览器进行绘制之前执行，这使得它适用于需要读取或操作 DOM 布局信息的情况。\n\nuseLayoutEffect 的作用是允许你在 React 更新 DOM 之后立即执行副作用，这对于需要在更新后立即访问 DOM 布局的情况非常有用。一些常见的用例包括：\n\n* 测量 DOM 元素的尺寸或位置。\n* 执行需要读取 DOM 布局信息的动画或过渡效果。\n* 调整 DOM 元素的样式或属性，以响应特定的布局更改。\n\n下面是 useLayoutEffect 的详细使用方法：\n```javascript\nimport React, { useLayoutEffect, useRef } from 'react';\n\nfunction MyComponent() {\n  const ref = useRef();\n\n  useLayoutEffect(() =\u003e {\n    // 在 DOM 更新后立即执行的副作用代码\n\n    // 读取 DOM 元素的尺寸或位置\n    const { width, height } = ref.current.getBoundingClientRect();\n    console.log('Element dimensions:', width, height);\n\n    // 执行动画或过渡效果\n    ref.current.style.transition = 'all 0.3s';\n    ref.current.style.transform = 'scale(1.2)';\n\n    // 返回一个清理函数，可选\n    return () =\u003e {\n      // 在组件卸载或下一次副作用执行之前执行的清理代码\n      ref.current.style.transition = '';\n      ref.current.style.transform = '';\n    };\n  }, []); // 传递一个空数组作为依赖项，以确保副作用只在组件首次渲染时执行\n\n  return \u003cdiv ref={ref}\u003eHello, world!\u003c/div\u003e;\n}\n```\n\n在上面的例子中，我们创建了一个函数式组件 MyComponent，使用 useRef 创建了一个 ref，并将其应用到 div 元素上。然后，我们使用 useLayoutEffect 创建一个副作用，该副作用在 DOM 更新后立即执行。\n\n在副作用函数中，我们首先使用 getBoundingClientRect 方法读取了 div 元素的尺寸和位置信息，并将其输出到控制台。然后，我们设置了一些样式属性，实现了一个简单的缩放动画。\n\n在最后，我们可以选择返回一个清理函数，它会在组件卸载或下一次副作用执行之前执行。在清理函数中，我们重置了之前设置的样式属性，以确保组件卸载或下一次副作用执行时的状态是正确的。\n\n需要注意的是，由于 useLayoutEffect 在浏览器进行绘制之前同步执行，它可能会阻塞组件的渲染。因此，要谨慎使用 useLayoutEffect，并确保你的副作用代码是高效的，以免对性能产生负面影响。如果副作用代码不需要在浏览器绘制之前立即执行，你可以考虑使用 useEffect 代替。\n\n\n### useDebugValue\nuseDebugValue 是一个自定义钩子函数，用于在 React 开发工具中为自定义钩子提供额外的调试信息。它可以帮助开发者在 React DevTools 中更好地理解自定义钩子的用途和状态。\n\nuseDebugValue 的作用是允许你为自定义钩子提供一个自定义的调试值，以便在 React DevTools 中显示。通过这种方式，你可以为自定义钩子提供有意义的标签，帮助你更好地理解和调试你的代码。\n\n下面是 useDebugValue 的详细使用方法：\n```javascript\nimport React, { useState, useDebugValue } from 'react';\n\nfunction useCustomHook(initialValue) {\n  const [value, setValue] = useState(initialValue);\n\n  // 自定义钩子的逻辑...\n\n  // 使用 useDebugValue 提供调试信息\n  useDebugValue(value, (value) =\u003e `Custom Hook Value: ${value}`);\n\n  return value;\n}\n\nfunction MyComponent() {\n  const customValue = useCustomHook('Hello');\n\n  return \u003cdiv\u003e{customValue}\u003c/div\u003e;\n}\n```\n在上面的例子中，我们创建了一个名为 useCustomHook 的自定义钩子函数。在这个自定义钩子函数内部，我们使用 useState 创建了一个状态变量 value，并返回了它。在自定义钩子函数的逻辑中，你可以根据需求添加其他的自定义逻辑。\n\n在 useDebugValue 中，我们传递了 value 和一个回调函数。回调函数接收 value 作为参数，并返回一个用于调试的字符串。在这个例子中，我们将 Custom Hook Value: ${value} 作为调试信息返回。\n\n然后，在 MyComponent 组件中，我们使用 useCustomHook 获取 customValue，并将其渲染在 \u003cdiv\u003e 中。\n\n当你使用 React DevTools 查看 MyComponent 组件时，你将在自定义钩子的部分看到类似于 \"Custom Hook Value: Hello\" 的调试标签，这可以帮助你更好地理解和调试你的自定义钩子的状态和行为。\n\n需要注意的是，useDebugValue 是一个开发工具函数，它不会影响实际的组件渲染逻辑，而仅仅提供了更好的调试体验。因此，当你完成调试时，可以安全地删除 useDebugValue 的调用，而不会对生产代码产生任何影响。\n\n### useDeferredValue\n是 React 中的一个实验性 Hook，它的主要作用是在更新状态时，允许延迟某些值的更新。这对于优化性能和提高用户体验非常有用，特别是在处理大量数据或复杂计算时。\n\n使用 useDeferredValue 的基本语法如下：\n```javascript\nconst deferredValue = useDeferredValue(value, { timeoutMs: 延迟时间 });\n```\n\nuseDeferredValue 接受两个参数：需要延迟更新的值和一个配置对象。配置对象中的 timeoutMs 属性用于设置延迟时间（以毫秒为单位）。\n以下是一个使用 useDeferredValue 的示例：\n```javascript\nimport React, { useState, useDeferredValue } from 'react';\n\nfunction App() {\n  const [text, setText] = useState('');\n  const [searchText, setSearchText] = useState('');\n\n  const deferredSearchText = useDeferredValue(searchText, { timeoutMs: 2000 });\n\n  const handleChange = (event) =\u003e {\n    setText(event.target.value);\n    setSearchText(event.target.value);\n  };\n\n  return (\n    \u003cdiv\u003e\n      \u003cinput type=\"text\" value={text} onChange={handleChange} /\u003e\n      \u003cp\u003e实时显示: {text}\u003c/p\u003e\n      \u003cp\u003e延迟显示: {deferredSearchText}\u003c/p\u003e\n    \u003c/div\u003e\n  );\n}\n\nexport default App;\n```\n在这个示例中，我们使用 useDeferredValue 来延迟显示用户输入的搜索文本。当用户输入文本时，实时显示的文本会立即更新，而延迟显示的文本会在 2 秒后更新。这可以帮助我们在处理大量数据或复杂计算时，优化性能和提高用户体验。\n\n请注意，useDeferredValue 目前仍处于实验阶段，因此在将来的 React 版本中可能会发生变化。在使用此 Hook 时，请确保您的应用程序使用了适当的 React 版本，并密切关注 React 团队的更新。\n\n### useTransition\n\n它用于在组件之间进行平滑过渡。这对于创建动画和管理组件的进入和退出非常有用。useTransition 可以帮助您在组件切换时实现更好的用户体验。\n\n使用 useTransition 的基本语法如下：\n```javascript\nconst [startTransition, isPending] = useTransition({\n  timeoutMs: 过渡超时时间,\n});\n```\n\nuseTransition 返回一个包含两个元素的数组：startTransition 函数和 isPending 布尔值。startTransition 函数用于开始过渡，而 isPending 值表示过渡是否正在进行中。\n\n以下是一个使用 useTransition 的示例：\n```javascript\nimport React, { useState, useTransition } from 'react';\n\nfunction App() {\n  const [isToggled, setIsToggled] = useState(false);\n  const [isPending, startTransition] = useTransition({ timeoutMs: 3000 });\n\n  const handleClick = () =\u003e {\n    startTransition(() =\u003e {\n      setIsToggled(!isToggled);\n    });\n  };\n\n  return (\n    \u003cdiv\u003e\n      \u003cbutton onClick={handleClick}\u003e切换\u003c/button\u003e\n      {isPending \u003cp\u003e过渡进行中...\u003c/p\u003e}\n      {isToggled ? \u003cdiv\u003e组件 A\u003c/div\u003e : \u003cdiv\u003e组件 B\u003c/div\u003e}\n    \u003c/div\u003e\n  );\n}\n\nexport default App;\n```\n\n在这个示例中我们使用 useTransition 来实现组件 A 和组件 B 之间的平滑过渡。当用户点击按钮时，startTransition 函数会触发过渡，并在 3 秒内完成。在过渡进行中，我们会显示一个提示消息。\n请注意，useTransition 目前仍处于实验阶段，因此在将来的 React 版本中可能会发生变化。在使用此 Hook 时，请确保的应用程序使用了适当的 React 版本，并密切关注 React 团队的更新。\n\n### useId\n用于生成传递给无障碍属性的唯一 ID。它的主要好处是 React 确保它能够与服务端渲染一起工作。在 React 中直接编写 ID 并不是一个好的习惯，因为一个组件可能会在页面上渲染多次，但是 ID 必须是唯一的。使用 useId 可以生成唯一的 ID，避免这个问题。\n\n用法示例：\n```javascript\nimport { useId } from 'react';\n\nfunction PasswordField() {\n  const passwordHintId = useId();\n\n  return (\n    \u003c\u003e\n      \u003clabel\u003e\n        密码:\n        \u003cinput type=\"password\" aria-describedby={passwordHintId} /\u003e\n      \u003c/label\u003e\n      \u003cp id={passwordHintId}\u003e密码应该包含至少 18 个字符\u003c/p\u003e\n    \u003c/\u003e\n  );\n}\n```\n在这个示例中，我们使用 useId 生成一个唯一的 ID，并将其分配给 passwordHintId。然后，我们将此 ID 用作 input 元素的 aria-describedby 属性值，以及相关提示文本的 id 属性值。\n\n如果你需要为多个相关元素生成 ID，可以调用 useId 来为它们生成共同的前缀：\n```javascript\nimport { useId } from 'react';\n\nexport default function Form() {\n  const id = useId();\n\n  return (\n    \u003cform\u003e\n      \u003clabel htmlFor={id + '-firstName'}\u003e名字：\u003c/label\u003e\n      \u003cinput id={id + '-firstName'} type=\"text\" /\u003e\n      \u003chr /\u003e\n      \u003clabel htmlFor={id + '-lastName'}\u003e姓氏：\u003c/label\u003e\n      \u003cinput id={id + '-lastName'} type=\"text\" /\u003e\n    \u003c/form\u003e\n  );\n}\n```\n\n在这个示例中，我们使用 useId 生成一个唯一的 ID，并将其分配给 id。然后，我们为名字和姓氏输入框添加相应的后缀，以创建唯一的 ID。\n\n### useSyncExternalStore\nuseSyncExternalStore 是 React 18 中引入的一个新 Hook，主要用于解决外部数据源的撕裂问题。它通常用于第三方状态管理库，如 Redux，以确保在并发渲染期间数据保持一致。在日常业务中，我们通常不需要关注这个 Hook，因为 React 的 useState 已经原生解决了并发特性下的撕裂问题。然而，对于框架开发者来说，useSyncStore 提供了一个有用的 API，以便更好地集成外部状态管理库。\n\nuseSyncExternalStore 的基本用法如下：\n```javascript\nconst state = useSyncExternal(\n  subscribe,\n  getSnapshot,\n  getServerSnapshot\n);\n```\nsubscribe：一个订阅函数，用于监听外部数据源的变化。当数据发生变化时，订阅函数应该通知 React 重新渲组件。\n\ngetSnapshot：一个获取当前数据快照的函数。这个函数应该返回外部数据源的当前状态。\n\ngetServerSnapshot：一个可选的函数，用于获取服务端渲染时的数据快照。这个函数在客户端渲染时不会被调用。\n\n以下是一个简单的示例，展示了如何使用 useSyncExternalStore：\n```javascript\nimport { useSyncExternalStore } from 'react';\n\n// 假设我们有一个外部数据源\nconst externalStore = {\n  data: 'Hello, world!',\n  listeners: new Set(),\n};\n\n// 订阅函数\nfunction subscribe(callback) {\n  externalStore.listeners.add(callback);\n  return () =\u003e {\n    externalStore.listeners.delete(callback);\n  };\n}\n\n// 获取数据快照的函数\nfunction getSnapshot() {\n  return externalStore.data;\n}\n\nfunction App() {\n  const data = useSyncExternalStore(subscribe, getSnapshot);\n\n  return \u003cdiv\u003e{data}\u003c/div\u003e;\n}\n```\n\n在这个示例中，我们使用 useSyncExternalStore 来订阅一个外部数据源，并在数据发生变化时重新渲染组件。请注意，这个示例仅用于演示目的，实际上你可能会使用像 Redux 这样的状态管理库来处理外部数据源。\nReact-Redux 8.0 已经基于 useSyncExternalStore 进行了实现，因此如果你使用 Redux，你可以直接使用新版本的 React-Redux 来获得与 React 18 的并发特性兼容的状态管理。\n\n### useInsertionEffect\nuseInsertionEffect 是一个新的 React 钩子，它主要用于解决 CSS-in-JS 库在渲染过程中注入样式的性能问题。这个钩子在 DOM 发生变化之后运行，但在布局效果读取新布局之前。这解决了 React 17 及更低版本中已经存在的问题，但在 React 18 中更为重要，因为 React 在并发渲染期间会屈服于浏览器，使其有机会重新计算布局。\n\n通常情况下，除你正在构建一个 CSS-in-JS 库，否则不建议使用 useInsertionEffect。这是因为它主要针对 CSS-in-JS 库的性能优化。\n\n使用方法如下：\n```javascript\nimport {InsertionEffect } from 'react';\n\nfunction MyComponent() {\n  useInsertionEffect(() =\u003e {\n    // 在这里插入样式或执行与样式相关的操作\n  });\n\n  // 组件的其他逻辑和渲染\n}\n\n```\n\nuseInsertionEffect 的回调函数中，你可以执行与样式相关的操作，例如插入样式或修改现有样式。这个钩子会确保在 DOM 发生变化后，但在布局效果读取新布局之前执行这些操作，从而提高性能\n","title":"React中的各种hook的使用","slug":"usage-of-various-hooks-in-react","intro":"React中的各种hook的使用如:useState、useEffect、useContext、useReducer、useCallback、useMemo、useRef、useTransition等","tags":"react,hooks","date":"2023-07-03"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"usage-of-various-hooks-in-react"},"buildId":"tfNd22Ko64wEoloeBUZNi","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>