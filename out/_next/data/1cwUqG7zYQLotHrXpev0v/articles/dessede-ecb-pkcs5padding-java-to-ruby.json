{"pageProps":{"articleData":{"markdownContent":"\n开发过程中，第三方SDK经常都是针对java、php、python、node.js的封装或者给出相应的事例，\n而针对 Ruby 的很少，工作中遇到了ECB加密解密的需求，\n下面给出Ruby 如何实现 Java 中的 ECB 加密解密的相关例子：\n\nJava 代码1:\n```java\nCipher cipher = Cipher.getInstance(\"DESede/ECB/PKCS5Padding\");\ncipher.init(Cipher.ENCRYPT_MODE, new SecretKeySpec(build3DesKey(secretKey), \"DESede\"));\nString base64Encode = getBase64Encode(cipher.doFinal(src.getBytes(\"UTF-8\")));\n```\n\n\nJava 代码2:\n```java\npublic static byte[] build3DesKey(String keyStr) throws UnsupportedEncodingException {\n  byte[] key = new byte[24];    //声明一个24位的字节数组，默认里面都是0\n  byte[] temp = keyStr.getBytes(\"UTF-8\");    //将字符串转成字节数组\n\n  /*\n  * 执行数组拷贝\n  * System.arraycopy(源数组，从源数组哪里开始拷贝，目标数组，拷贝多少位)\n  */\n  if(key.length > temp.length){\n    //如果temp不够24位，则拷贝temp数组整个长度的内容到key数组中\n    System.arraycopy(temp, 0, key, 0, temp.length);\n  }else{\n    //如果temp大于24位，则拷贝temp数组24个长度的内容到key数组中\n    System.arraycopy(temp, 0, key, 0, key.length);\n  }\n  System.out.println(\"aaaaa\");\n  System.out.println(key);\n  System.out.println(key.length);\n  for(int i=0; i< key.length ; i++) {\n    System.out.print(key[i] +\" \");\n  }\n  System.out.println(\"aaaaa\");\n  return key;\n}\n```\n\nruby对应的加密解密\n\n```rb\nrequire 'base64'\nrequire 'digest'\nrequire 'openssl'\n\nmodule Des3Encrypt\n  def self.cipher(mode, key, iv, data)\n    cipher = OpenSSL::Cipher.new('DES-EDE3').send(mode)\n    cipher.key = build_3des_key(key)\n    cipher.iv  = iv if iv\n\n    encrypted = ''\n    encrypted << cipher.update(data)\n    encrypted << cipher.final\n    encrypted\n  end\n\n  def self.encrypt(key, iv, data)\n    Base64.strict_encode64 cipher(:encrypt, key, iv, data)\n  end\n\n  def self.decrypt(key, iv, data)\n    cipher(:decrypt, key, iv, Base64.strict_decode64(data))\n  end\n\n  def self.build_3des_key(key)\n    key_bytes_length = key.bytes.length\n    skey = if key_bytes_length < 24\n      key.bytes + (0...(24 - key_bytes_length)).to_a.map{|x| 0}\n    else\n      key.bytes[0...24]\n    end\n\n    skey.pack(\"c*\")\n  end\n\n  def self.md5_capital(str)\n    Digest::MD5.hexdigest(str).upcase\n  end\nend\n```","title":"Ruby 实现 Java 中的\"DESede/ECB/PKCS5Padding\"的加密","slug":"dessede-ecb-pkcs5padding-java-to-ruby","intro":"开发过程中，第三方SDK经常都是针对java、php、python、node.js的封装或者给出相应的事例，而针对 Ruby 的很少，工作中遇到了ECB加密解密的需求，下面给出Ruby 如何实现 Java 中的 ECB 加密解密的相关例子","tags":"ruby, java, ecb加密","date":"2020-10-11"}},"__N_SSG":true}